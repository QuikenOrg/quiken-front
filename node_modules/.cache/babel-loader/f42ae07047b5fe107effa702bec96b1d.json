{"ast":null,"code":"'use strict';\n\nvar TraversalTracker = require('./traversalTracker');\n\nvar isString = require('./helpers').isString;\n/**\r\n * Creates an instance of DocumentContext - a store for current x, y positions and available width/height.\r\n * It facilitates column divisions and vertical sync\r\n */\n\n\nfunction DocumentContext(pageSize, pageMargins) {\n  this.pages = [];\n  this.pageMargins = pageMargins;\n  this.x = pageMargins.left;\n  this.availableWidth = pageSize.width - pageMargins.left - pageMargins.right;\n  this.availableHeight = 0;\n  this.page = -1;\n  this.snapshots = [];\n  this.endingCell = null;\n  this.tracker = new TraversalTracker();\n  this.backgroundLength = [];\n  this.addPage(pageSize);\n}\n\nDocumentContext.prototype.beginColumnGroup = function () {\n  this.snapshots.push({\n    x: this.x,\n    y: this.y,\n    availableHeight: this.availableHeight,\n    availableWidth: this.availableWidth,\n    page: this.page,\n    bottomMost: {\n      x: this.x,\n      y: this.y,\n      availableHeight: this.availableHeight,\n      availableWidth: this.availableWidth,\n      page: this.page\n    },\n    endingCell: this.endingCell,\n    lastColumnWidth: this.lastColumnWidth\n  });\n  this.lastColumnWidth = 0;\n};\n\nDocumentContext.prototype.beginColumn = function (width, offset, endingCell) {\n  var saved = this.snapshots[this.snapshots.length - 1];\n  this.calculateBottomMost(saved);\n  this.endingCell = endingCell;\n  this.page = saved.page;\n  this.x = this.x + this.lastColumnWidth + (offset || 0);\n  this.y = saved.y;\n  this.availableWidth = width; //saved.availableWidth - offset;\n\n  this.availableHeight = saved.availableHeight;\n  this.lastColumnWidth = width;\n};\n\nDocumentContext.prototype.calculateBottomMost = function (destContext) {\n  if (this.endingCell) {\n    this.saveContextInEndingCell(this.endingCell);\n    this.endingCell = null;\n  } else {\n    destContext.bottomMost = bottomMostContext(this, destContext.bottomMost);\n  }\n};\n\nDocumentContext.prototype.markEnding = function (endingCell) {\n  this.page = endingCell._columnEndingContext.page;\n  this.x = endingCell._columnEndingContext.x;\n  this.y = endingCell._columnEndingContext.y;\n  this.availableWidth = endingCell._columnEndingContext.availableWidth;\n  this.availableHeight = endingCell._columnEndingContext.availableHeight;\n  this.lastColumnWidth = endingCell._columnEndingContext.lastColumnWidth;\n};\n\nDocumentContext.prototype.saveContextInEndingCell = function (endingCell) {\n  endingCell._columnEndingContext = {\n    page: this.page,\n    x: this.x,\n    y: this.y,\n    availableHeight: this.availableHeight,\n    availableWidth: this.availableWidth,\n    lastColumnWidth: this.lastColumnWidth\n  };\n};\n\nDocumentContext.prototype.completeColumnGroup = function (height) {\n  var saved = this.snapshots.pop();\n  this.calculateBottomMost(saved);\n  this.endingCell = null;\n  this.x = saved.x;\n  var y = saved.bottomMost.y;\n\n  if (height) {\n    if (saved.page === saved.bottomMost.page) {\n      if (saved.y + height > y) {\n        y = saved.y + height;\n      }\n    } else {\n      y += height;\n    }\n  }\n\n  this.y = y;\n  this.page = saved.bottomMost.page;\n  this.availableWidth = saved.availableWidth;\n  this.availableHeight = saved.bottomMost.availableHeight;\n\n  if (height) {\n    this.availableHeight -= y - saved.bottomMost.y;\n  }\n\n  this.lastColumnWidth = saved.lastColumnWidth;\n};\n\nDocumentContext.prototype.addMargin = function (left, right) {\n  this.x += left;\n  this.availableWidth -= left + (right || 0);\n};\n\nDocumentContext.prototype.moveDown = function (offset) {\n  this.y += offset;\n  this.availableHeight -= offset;\n  return this.availableHeight > 0;\n};\n\nDocumentContext.prototype.initializePage = function () {\n  this.y = this.pageMargins.top;\n  this.availableHeight = this.getCurrentPage().pageSize.height - this.pageMargins.top - this.pageMargins.bottom;\n  this.pageSnapshot().availableWidth = this.getCurrentPage().pageSize.width - this.pageMargins.left - this.pageMargins.right;\n};\n\nDocumentContext.prototype.pageSnapshot = function () {\n  if (this.snapshots[0]) {\n    return this.snapshots[0];\n  } else {\n    return this;\n  }\n};\n\nDocumentContext.prototype.moveTo = function (x, y) {\n  if (x !== undefined && x !== null) {\n    this.x = x;\n    this.availableWidth = this.getCurrentPage().pageSize.width - this.x - this.pageMargins.right;\n  }\n\n  if (y !== undefined && y !== null) {\n    this.y = y;\n    this.availableHeight = this.getCurrentPage().pageSize.height - this.y - this.pageMargins.bottom;\n  }\n};\n\nDocumentContext.prototype.moveToRelative = function (x, y) {\n  if (x !== undefined && x !== null) {\n    this.x = this.x + x;\n  }\n\n  if (y !== undefined && y !== null) {\n    this.y = this.y + y;\n  }\n};\n\nDocumentContext.prototype.beginDetachedBlock = function () {\n  this.snapshots.push({\n    x: this.x,\n    y: this.y,\n    availableHeight: this.availableHeight,\n    availableWidth: this.availableWidth,\n    page: this.page,\n    endingCell: this.endingCell,\n    lastColumnWidth: this.lastColumnWidth\n  });\n};\n\nDocumentContext.prototype.endDetachedBlock = function () {\n  var saved = this.snapshots.pop();\n  this.x = saved.x;\n  this.y = saved.y;\n  this.availableWidth = saved.availableWidth;\n  this.availableHeight = saved.availableHeight;\n  this.page = saved.page;\n  this.endingCell = saved.endingCell;\n  this.lastColumnWidth = saved.lastColumnWidth;\n};\n\nfunction pageOrientation(pageOrientationString, currentPageOrientation) {\n  if (pageOrientationString === undefined) {\n    return currentPageOrientation;\n  } else if (isString(pageOrientationString) && pageOrientationString.toLowerCase() === 'landscape') {\n    return 'landscape';\n  } else {\n    return 'portrait';\n  }\n}\n\nvar getPageSize = function (currentPage, newPageOrientation) {\n  newPageOrientation = pageOrientation(newPageOrientation, currentPage.pageSize.orientation);\n\n  if (newPageOrientation !== currentPage.pageSize.orientation) {\n    return {\n      orientation: newPageOrientation,\n      width: currentPage.pageSize.height,\n      height: currentPage.pageSize.width\n    };\n  } else {\n    return {\n      orientation: currentPage.pageSize.orientation,\n      width: currentPage.pageSize.width,\n      height: currentPage.pageSize.height\n    };\n  }\n};\n\nDocumentContext.prototype.moveToNextPage = function (pageOrientation) {\n  var nextPageIndex = this.page + 1;\n  var prevPage = this.page;\n  var prevY = this.y;\n  var createNewPage = nextPageIndex >= this.pages.length;\n\n  if (createNewPage) {\n    var currentAvailableWidth = this.availableWidth;\n    var currentPageOrientation = this.getCurrentPage().pageSize.orientation;\n    var pageSize = getPageSize(this.getCurrentPage(), pageOrientation);\n    this.addPage(pageSize);\n\n    if (currentPageOrientation === pageSize.orientation) {\n      this.availableWidth = currentAvailableWidth;\n    }\n  } else {\n    this.page = nextPageIndex;\n    this.initializePage();\n  }\n\n  return {\n    newPageCreated: createNewPage,\n    prevPage: prevPage,\n    prevY: prevY,\n    y: this.y\n  };\n};\n\nDocumentContext.prototype.addPage = function (pageSize) {\n  var page = {\n    items: [],\n    pageSize: pageSize\n  };\n  this.pages.push(page);\n  this.backgroundLength.push(0);\n  this.page = this.pages.length - 1;\n  this.initializePage();\n  this.tracker.emit('pageAdded');\n  return page;\n};\n\nDocumentContext.prototype.getCurrentPage = function () {\n  if (this.page < 0 || this.page >= this.pages.length) {\n    return null;\n  }\n\n  return this.pages[this.page];\n};\n\nDocumentContext.prototype.getCurrentPosition = function () {\n  var pageSize = this.getCurrentPage().pageSize;\n  var innerHeight = pageSize.height - this.pageMargins.top - this.pageMargins.bottom;\n  var innerWidth = pageSize.width - this.pageMargins.left - this.pageMargins.right;\n  return {\n    pageNumber: this.page + 1,\n    pageOrientation: pageSize.orientation,\n    pageInnerHeight: innerHeight,\n    pageInnerWidth: innerWidth,\n    left: this.x,\n    top: this.y,\n    verticalRatio: (this.y - this.pageMargins.top) / innerHeight,\n    horizontalRatio: (this.x - this.pageMargins.left) / innerWidth\n  };\n};\n\nfunction bottomMostContext(c1, c2) {\n  var r;\n\n  if (c1.page > c2.page) {\n    r = c1;\n  } else if (c2.page > c1.page) {\n    r = c2;\n  } else {\n    r = c1.y > c2.y ? c1 : c2;\n  }\n\n  return {\n    page: r.page,\n    x: r.x,\n    y: r.y,\n    availableHeight: r.availableHeight,\n    availableWidth: r.availableWidth\n  };\n}\n\nmodule.exports = DocumentContext;","map":{"version":3,"sources":["/home/julianallende/Desktop/proyecto_sapo/client/node_modules/pdfmake/src/documentContext.js"],"names":["TraversalTracker","require","isString","DocumentContext","pageSize","pageMargins","pages","x","left","availableWidth","width","right","availableHeight","page","snapshots","endingCell","tracker","backgroundLength","addPage","prototype","beginColumnGroup","push","y","bottomMost","lastColumnWidth","beginColumn","offset","saved","length","calculateBottomMost","destContext","saveContextInEndingCell","bottomMostContext","markEnding","_columnEndingContext","completeColumnGroup","height","pop","addMargin","moveDown","initializePage","top","getCurrentPage","bottom","pageSnapshot","moveTo","undefined","moveToRelative","beginDetachedBlock","endDetachedBlock","pageOrientation","pageOrientationString","currentPageOrientation","toLowerCase","getPageSize","currentPage","newPageOrientation","orientation","moveToNextPage","nextPageIndex","prevPage","prevY","createNewPage","currentAvailableWidth","newPageCreated","items","emit","getCurrentPosition","innerHeight","innerWidth","pageNumber","pageInnerHeight","pageInnerWidth","verticalRatio","horizontalRatio","c1","c2","r","module","exports"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nvar TraversalTracker = require('./traversalTracker');\r\nvar isString = require('./helpers').isString;\r\n\r\n/**\r\n * Creates an instance of DocumentContext - a store for current x, y positions and available width/height.\r\n * It facilitates column divisions and vertical sync\r\n */\r\nfunction DocumentContext(pageSize, pageMargins) {\r\n\tthis.pages = [];\r\n\r\n\tthis.pageMargins = pageMargins;\r\n\r\n\tthis.x = pageMargins.left;\r\n\tthis.availableWidth = pageSize.width - pageMargins.left - pageMargins.right;\r\n\tthis.availableHeight = 0;\r\n\tthis.page = -1;\r\n\r\n\tthis.snapshots = [];\r\n\r\n\tthis.endingCell = null;\r\n\r\n\tthis.tracker = new TraversalTracker();\r\n\r\n\tthis.backgroundLength = [];\r\n\r\n\tthis.addPage(pageSize);\r\n}\r\n\r\nDocumentContext.prototype.beginColumnGroup = function () {\r\n\tthis.snapshots.push({\r\n\t\tx: this.x,\r\n\t\ty: this.y,\r\n\t\tavailableHeight: this.availableHeight,\r\n\t\tavailableWidth: this.availableWidth,\r\n\t\tpage: this.page,\r\n\t\tbottomMost: {\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t\tavailableHeight: this.availableHeight,\r\n\t\t\tavailableWidth: this.availableWidth,\r\n\t\t\tpage: this.page\r\n\t\t},\r\n\t\tendingCell: this.endingCell,\r\n\t\tlastColumnWidth: this.lastColumnWidth\r\n\t});\r\n\r\n\tthis.lastColumnWidth = 0;\r\n};\r\n\r\nDocumentContext.prototype.beginColumn = function (width, offset, endingCell) {\r\n\tvar saved = this.snapshots[this.snapshots.length - 1];\r\n\r\n\tthis.calculateBottomMost(saved);\r\n\r\n\tthis.endingCell = endingCell;\r\n\tthis.page = saved.page;\r\n\tthis.x = this.x + this.lastColumnWidth + (offset || 0);\r\n\tthis.y = saved.y;\r\n\tthis.availableWidth = width;\t//saved.availableWidth - offset;\r\n\tthis.availableHeight = saved.availableHeight;\r\n\r\n\tthis.lastColumnWidth = width;\r\n};\r\n\r\nDocumentContext.prototype.calculateBottomMost = function (destContext) {\r\n\tif (this.endingCell) {\r\n\t\tthis.saveContextInEndingCell(this.endingCell);\r\n\t\tthis.endingCell = null;\r\n\t} else {\r\n\t\tdestContext.bottomMost = bottomMostContext(this, destContext.bottomMost);\r\n\t}\r\n};\r\n\r\nDocumentContext.prototype.markEnding = function (endingCell) {\r\n\tthis.page = endingCell._columnEndingContext.page;\r\n\tthis.x = endingCell._columnEndingContext.x;\r\n\tthis.y = endingCell._columnEndingContext.y;\r\n\tthis.availableWidth = endingCell._columnEndingContext.availableWidth;\r\n\tthis.availableHeight = endingCell._columnEndingContext.availableHeight;\r\n\tthis.lastColumnWidth = endingCell._columnEndingContext.lastColumnWidth;\r\n};\r\n\r\nDocumentContext.prototype.saveContextInEndingCell = function (endingCell) {\r\n\tendingCell._columnEndingContext = {\r\n\t\tpage: this.page,\r\n\t\tx: this.x,\r\n\t\ty: this.y,\r\n\t\tavailableHeight: this.availableHeight,\r\n\t\tavailableWidth: this.availableWidth,\r\n\t\tlastColumnWidth: this.lastColumnWidth\r\n\t};\r\n};\r\n\r\nDocumentContext.prototype.completeColumnGroup = function (height) {\r\n\tvar saved = this.snapshots.pop();\r\n\r\n\tthis.calculateBottomMost(saved);\r\n\r\n\tthis.endingCell = null;\r\n\tthis.x = saved.x;\r\n\r\n\tvar y = saved.bottomMost.y;\r\n\tif (height) {\r\n\t\tif (saved.page === saved.bottomMost.page) {\r\n\t\t\tif ((saved.y + height) > y) {\r\n\t\t\t\ty = saved.y + height;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ty += height;\r\n\t\t}\r\n\t}\r\n\r\n\tthis.y = y;\r\n\tthis.page = saved.bottomMost.page;\r\n\tthis.availableWidth = saved.availableWidth;\r\n\tthis.availableHeight = saved.bottomMost.availableHeight;\r\n\tif (height) {\r\n\t\tthis.availableHeight -= (y - saved.bottomMost.y);\r\n\t}\r\n\tthis.lastColumnWidth = saved.lastColumnWidth;\r\n};\r\n\r\nDocumentContext.prototype.addMargin = function (left, right) {\r\n\tthis.x += left;\r\n\tthis.availableWidth -= left + (right || 0);\r\n};\r\n\r\nDocumentContext.prototype.moveDown = function (offset) {\r\n\tthis.y += offset;\r\n\tthis.availableHeight -= offset;\r\n\r\n\treturn this.availableHeight > 0;\r\n};\r\n\r\nDocumentContext.prototype.initializePage = function () {\r\n\tthis.y = this.pageMargins.top;\r\n\tthis.availableHeight = this.getCurrentPage().pageSize.height - this.pageMargins.top - this.pageMargins.bottom;\r\n\tthis.pageSnapshot().availableWidth = this.getCurrentPage().pageSize.width - this.pageMargins.left - this.pageMargins.right;\r\n};\r\n\r\nDocumentContext.prototype.pageSnapshot = function () {\r\n\tif (this.snapshots[0]) {\r\n\t\treturn this.snapshots[0];\r\n\t} else {\r\n\t\treturn this;\r\n\t}\r\n};\r\n\r\nDocumentContext.prototype.moveTo = function (x, y) {\r\n\tif (x !== undefined && x !== null) {\r\n\t\tthis.x = x;\r\n\t\tthis.availableWidth = this.getCurrentPage().pageSize.width - this.x - this.pageMargins.right;\r\n\t}\r\n\tif (y !== undefined && y !== null) {\r\n\t\tthis.y = y;\r\n\t\tthis.availableHeight = this.getCurrentPage().pageSize.height - this.y - this.pageMargins.bottom;\r\n\t}\r\n};\r\n\r\nDocumentContext.prototype.moveToRelative = function (x, y) {\r\n\tif (x !== undefined && x !== null) {\r\n\t\tthis.x = this.x + x;\r\n\t}\r\n\tif (y !== undefined && y !== null) {\r\n\t\tthis.y = this.y + y;\r\n\t}\r\n};\r\n\r\nDocumentContext.prototype.beginDetachedBlock = function () {\r\n\tthis.snapshots.push({\r\n\t\tx: this.x,\r\n\t\ty: this.y,\r\n\t\tavailableHeight: this.availableHeight,\r\n\t\tavailableWidth: this.availableWidth,\r\n\t\tpage: this.page,\r\n\t\tendingCell: this.endingCell,\r\n\t\tlastColumnWidth: this.lastColumnWidth\r\n\t});\r\n};\r\n\r\nDocumentContext.prototype.endDetachedBlock = function () {\r\n\tvar saved = this.snapshots.pop();\r\n\r\n\tthis.x = saved.x;\r\n\tthis.y = saved.y;\r\n\tthis.availableWidth = saved.availableWidth;\r\n\tthis.availableHeight = saved.availableHeight;\r\n\tthis.page = saved.page;\r\n\tthis.endingCell = saved.endingCell;\r\n\tthis.lastColumnWidth = saved.lastColumnWidth;\r\n};\r\n\r\nfunction pageOrientation(pageOrientationString, currentPageOrientation) {\r\n\tif (pageOrientationString === undefined) {\r\n\t\treturn currentPageOrientation;\r\n\t} else if (isString(pageOrientationString) && (pageOrientationString.toLowerCase() === 'landscape')) {\r\n\t\treturn 'landscape';\r\n\t} else {\r\n\t\treturn 'portrait';\r\n\t}\r\n}\r\n\r\nvar getPageSize = function (currentPage, newPageOrientation) {\r\n\r\n\tnewPageOrientation = pageOrientation(newPageOrientation, currentPage.pageSize.orientation);\r\n\r\n\tif (newPageOrientation !== currentPage.pageSize.orientation) {\r\n\t\treturn {\r\n\t\t\torientation: newPageOrientation,\r\n\t\t\twidth: currentPage.pageSize.height,\r\n\t\t\theight: currentPage.pageSize.width\r\n\t\t};\r\n\t} else {\r\n\t\treturn {\r\n\t\t\torientation: currentPage.pageSize.orientation,\r\n\t\t\twidth: currentPage.pageSize.width,\r\n\t\t\theight: currentPage.pageSize.height\r\n\t\t};\r\n\t}\r\n\r\n};\r\n\r\n\r\nDocumentContext.prototype.moveToNextPage = function (pageOrientation) {\r\n\tvar nextPageIndex = this.page + 1;\r\n\r\n\tvar prevPage = this.page;\r\n\tvar prevY = this.y;\r\n\r\n\tvar createNewPage = nextPageIndex >= this.pages.length;\r\n\tif (createNewPage) {\r\n\t\tvar currentAvailableWidth = this.availableWidth;\r\n\t\tvar currentPageOrientation = this.getCurrentPage().pageSize.orientation;\r\n\r\n\t\tvar pageSize = getPageSize(this.getCurrentPage(), pageOrientation);\r\n\t\tthis.addPage(pageSize);\r\n\r\n\t\tif (currentPageOrientation === pageSize.orientation) {\r\n\t\t\tthis.availableWidth = currentAvailableWidth;\r\n\t\t}\r\n\t} else {\r\n\t\tthis.page = nextPageIndex;\r\n\t\tthis.initializePage();\r\n\t}\r\n\r\n\treturn {\r\n\t\tnewPageCreated: createNewPage,\r\n\t\tprevPage: prevPage,\r\n\t\tprevY: prevY,\r\n\t\ty: this.y\r\n\t};\r\n};\r\n\r\n\r\nDocumentContext.prototype.addPage = function (pageSize) {\r\n\tvar page = { items: [], pageSize: pageSize };\r\n\tthis.pages.push(page);\r\n\tthis.backgroundLength.push(0);\r\n\tthis.page = this.pages.length - 1;\r\n\tthis.initializePage();\r\n\r\n\tthis.tracker.emit('pageAdded');\r\n\r\n\treturn page;\r\n};\r\n\r\nDocumentContext.prototype.getCurrentPage = function () {\r\n\tif (this.page < 0 || this.page >= this.pages.length) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn this.pages[this.page];\r\n};\r\n\r\nDocumentContext.prototype.getCurrentPosition = function () {\r\n\tvar pageSize = this.getCurrentPage().pageSize;\r\n\tvar innerHeight = pageSize.height - this.pageMargins.top - this.pageMargins.bottom;\r\n\tvar innerWidth = pageSize.width - this.pageMargins.left - this.pageMargins.right;\r\n\r\n\treturn {\r\n\t\tpageNumber: this.page + 1,\r\n\t\tpageOrientation: pageSize.orientation,\r\n\t\tpageInnerHeight: innerHeight,\r\n\t\tpageInnerWidth: innerWidth,\r\n\t\tleft: this.x,\r\n\t\ttop: this.y,\r\n\t\tverticalRatio: ((this.y - this.pageMargins.top) / innerHeight),\r\n\t\thorizontalRatio: ((this.x - this.pageMargins.left) / innerWidth)\r\n\t};\r\n};\r\n\r\nfunction bottomMostContext(c1, c2) {\r\n\tvar r;\r\n\r\n\tif (c1.page > c2.page) {\r\n\t\tr = c1;\r\n\t} else if (c2.page > c1.page) {\r\n\t\tr = c2;\r\n\t} else {\r\n\t\tr = (c1.y > c2.y) ? c1 : c2;\r\n\t}\r\n\r\n\treturn {\r\n\t\tpage: r.page,\r\n\t\tx: r.x,\r\n\t\ty: r.y,\r\n\t\tavailableHeight: r.availableHeight,\r\n\t\tavailableWidth: r.availableWidth\r\n\t};\r\n}\r\n\r\nmodule.exports = DocumentContext;\r\n"]},"metadata":{},"sourceType":"script"}