{"ast":null,"code":"/*eslint no-unused-vars: [\"error\", {\"args\": \"none\"}]*/\n'use strict';\n\nvar PdfKitEngine = require('./pdfKitEngine');\n\nvar FontProvider = require('./fontProvider');\n\nvar LayoutBuilder = require('./layoutBuilder');\n\nvar sizes = require('./standardPageSizes');\n\nvar ImageMeasure = require('./imageMeasure');\n\nvar SVGMeasure = require('./svgMeasure');\n\nvar textDecorator = require('./textDecorator');\n\nvar TextTools = require('./textTools');\n\nvar isFunction = require('./helpers').isFunction;\n\nvar isString = require('./helpers').isString;\n\nvar isNumber = require('./helpers').isNumber;\n\nvar isBoolean = require('./helpers').isBoolean;\n\nvar isArray = require('./helpers').isArray;\n\nvar isUndefined = require('./helpers').isUndefined;\n\nvar getSvgToPDF = function () {\n  try {\n    // optional dependency to support svg nodes\n    return require('svg-to-pdfkit');\n  } catch (e) {\n    throw new Error('Please install svg-to-pdfkit to enable svg nodes');\n  }\n};\n\nvar findFont = function (fonts, requiredFonts, defaultFont) {\n  for (var i = 0; i < requiredFonts.length; i++) {\n    var requiredFont = requiredFonts[i].toLowerCase();\n\n    for (var font in fonts) {\n      if (font.toLowerCase() === requiredFont) {\n        return font;\n      }\n    }\n  }\n\n  return defaultFont;\n}; ////////////////////////////////////////\n// PdfPrinter\n\n/**\r\n * @class Creates an instance of a PdfPrinter which turns document definition into a pdf\r\n *\r\n * @param {Object} fontDescriptors font definition dictionary\r\n *\r\n * @example\r\n * var fontDescriptors = {\r\n *\tRoboto: {\r\n *\t\tnormal: 'fonts/Roboto-Regular.ttf',\r\n *\t\tbold: 'fonts/Roboto-Medium.ttf',\r\n *\t\titalics: 'fonts/Roboto-Italic.ttf',\r\n *\t\tbolditalics: 'fonts/Roboto-MediumItalic.ttf'\r\n *\t}\r\n * };\r\n *\r\n * var printer = new PdfPrinter(fontDescriptors);\r\n */\n\n\nfunction PdfPrinter(fontDescriptors) {\n  this.fontDescriptors = fontDescriptors;\n}\n/**\r\n * Executes layout engine for the specified document and renders it into a pdfkit document\r\n * ready to be saved.\r\n *\r\n * @param {Object} docDefinition document definition\r\n * @param {Object} docDefinition.content an array describing the pdf structure (for more information take a look at the examples in the /examples folder)\r\n * @param {Object} [docDefinition.defaultStyle] default (implicit) style definition\r\n * @param {Object} [docDefinition.styles] dictionary defining all styles which can be used in the document\r\n * @param {Object} [docDefinition.pageSize] page size (pdfkit units, A4 dimensions by default)\r\n * @param {Number} docDefinition.pageSize.width width\r\n * @param {Number} docDefinition.pageSize.height height\r\n * @param {Object} [docDefinition.pageMargins] page margins (pdfkit units)\r\n * @param {Number} docDefinition.maxPagesNumber maximum number of pages to render\r\n *\r\n * @example\r\n *\r\n * var docDefinition = {\r\n * \tinfo: {\r\n *\t\ttitle: 'awesome Document',\r\n *\t\tauthor: 'john doe',\r\n *\t\tsubject: 'subject of document',\r\n *\t\tkeywords: 'keywords for document',\r\n * \t},\r\n *\tcontent: [\r\n *\t\t'First paragraph',\r\n *\t\t'Second paragraph, this time a little bit longer',\r\n *\t\t{ text: 'Third paragraph, slightly bigger font size', fontSize: 20 },\r\n *\t\t{ text: 'Another paragraph using a named style', style: 'header' },\r\n *\t\t{ text: ['playing with ', 'inlines' ] },\r\n *\t\t{ text: ['and ', { text: 'restyling ', bold: true }, 'them'] },\r\n *\t],\r\n *\tstyles: {\r\n *\t\theader: { fontSize: 30, bold: true }\r\n *\t}\r\n * }\r\n *\r\n * var pdfKitDoc = printer.createPdfKitDocument(docDefinition);\r\n *\r\n * pdfKitDoc.pipe(fs.createWriteStream('sample.pdf'));\r\n * pdfKitDoc.end();\r\n *\r\n * @return {Object} a pdfKit document object which can be saved or encode to data-url\r\n */\n\n\nPdfPrinter.prototype.createPdfKitDocument = function (docDefinition, options) {\n  options = options || {};\n  docDefinition.version = docDefinition.version || '1.3';\n  docDefinition.compress = isBoolean(docDefinition.compress) ? docDefinition.compress : true;\n  docDefinition.images = docDefinition.images || {};\n  docDefinition.pageMargins = docDefinition.pageMargins !== undefined && docDefinition.pageMargins !== null ? docDefinition.pageMargins : 40;\n  var pageSize = fixPageSize(docDefinition.pageSize, docDefinition.pageOrientation);\n  var pdfOptions = {\n    size: [pageSize.width, pageSize.height],\n    pdfVersion: docDefinition.version,\n    compress: docDefinition.compress,\n    userPassword: docDefinition.userPassword,\n    ownerPassword: docDefinition.ownerPassword,\n    permissions: docDefinition.permissions,\n    fontLayoutCache: isBoolean(options.fontLayoutCache) ? options.fontLayoutCache : true,\n    bufferPages: options.bufferPages || false,\n    autoFirstPage: false,\n    font: null\n  };\n  this.pdfKitDoc = PdfKitEngine.createPdfDocument(pdfOptions);\n  setMetadata(docDefinition, this.pdfKitDoc);\n  this.fontProvider = new FontProvider(this.fontDescriptors, this.pdfKitDoc);\n  var builder = new LayoutBuilder(pageSize, fixPageMargins(docDefinition.pageMargins), new ImageMeasure(this.pdfKitDoc, docDefinition.images), new SVGMeasure());\n  registerDefaultTableLayouts(builder);\n\n  if (options.tableLayouts) {\n    builder.registerTableLayouts(options.tableLayouts);\n  }\n\n  var pages = builder.layoutDocument(docDefinition.content, this.fontProvider, docDefinition.styles || {}, docDefinition.defaultStyle || {\n    fontSize: 12,\n    font: 'Roboto'\n  }, docDefinition.background, docDefinition.header, docDefinition.footer, docDefinition.images, docDefinition.watermark, docDefinition.pageBreakBefore);\n  var maxNumberPages = docDefinition.maxPagesNumber || -1;\n\n  if (isNumber(maxNumberPages) && maxNumberPages > -1) {\n    pages = pages.slice(0, maxNumberPages);\n  } // if pageSize.height is set to Infinity, calculate the actual height of the page that\n  // was laid out using the height of each of the items in the page.\n\n\n  if (pageSize.height === Infinity) {\n    var pageHeight = calculatePageHeight(pages, docDefinition.pageMargins);\n    this.pdfKitDoc.options.size = [pageSize.width, pageHeight];\n  }\n\n  renderPages(pages, this.fontProvider, this.pdfKitDoc, options.progressCallback);\n\n  if (options.autoPrint) {\n    var printActionRef = this.pdfKitDoc.ref({\n      Type: 'Action',\n      S: 'Named',\n      N: 'Print'\n    });\n    this.pdfKitDoc._root.data.OpenAction = printActionRef;\n    printActionRef.end();\n  }\n\n  return this.pdfKitDoc;\n};\n\nfunction setMetadata(docDefinition, pdfKitDoc) {\n  // PDF standard has these properties reserved: Title, Author, Subject, Keywords,\n  // Creator, Producer, CreationDate, ModDate, Trapped.\n  // To keep the pdfmake api consistent, the info field are defined lowercase.\n  // Custom properties don't contain a space.\n  function standardizePropertyKey(key) {\n    var standardProperties = ['Title', 'Author', 'Subject', 'Keywords', 'Creator', 'Producer', 'CreationDate', 'ModDate', 'Trapped'];\n    var standardizedKey = key.charAt(0).toUpperCase() + key.slice(1);\n\n    if (standardProperties.indexOf(standardizedKey) !== -1) {\n      return standardizedKey;\n    }\n\n    return key.replace(/\\s+/g, '');\n  }\n\n  pdfKitDoc.info.Producer = 'pdfmake';\n  pdfKitDoc.info.Creator = 'pdfmake';\n\n  if (docDefinition.info) {\n    for (var key in docDefinition.info) {\n      var value = docDefinition.info[key];\n\n      if (value) {\n        key = standardizePropertyKey(key);\n        pdfKitDoc.info[key] = value;\n      }\n    }\n  }\n}\n\nfunction calculatePageHeight(pages, margins) {\n  function getItemHeight(item) {\n    if (isFunction(item.item.getHeight)) {\n      return item.item.getHeight();\n    } else if (item.item._height) {\n      return item.item._height;\n    } else if (item.type === 'vector') {\n      return item.item.y1 > item.item.y2 ? item.item.y1 : item.item.y2;\n    } else {\n      // TODO: add support for next item types\n      return 0;\n    }\n  }\n\n  function getBottomPosition(item) {\n    var top = item.item.y || 0;\n    var height = getItemHeight(item);\n    return top + height;\n  }\n\n  var fixedMargins = fixPageMargins(margins || 40);\n  var height = fixedMargins.top;\n  pages.forEach(function (page) {\n    page.items.forEach(function (item) {\n      var bottomPosition = getBottomPosition(item);\n\n      if (bottomPosition > height) {\n        height = bottomPosition;\n      }\n    });\n  });\n  height += fixedMargins.bottom;\n  return height;\n}\n\nfunction fixPageSize(pageSize, pageOrientation) {\n  function isNeedSwapPageSizes(pageOrientation) {\n    if (isString(pageOrientation)) {\n      pageOrientation = pageOrientation.toLowerCase();\n      return pageOrientation === 'portrait' && size.width > size.height || pageOrientation === 'landscape' && size.width < size.height;\n    }\n\n    return false;\n  } // if pageSize.height is set to auto, set the height to infinity so there are no page breaks.\n\n\n  if (pageSize && pageSize.height === 'auto') {\n    pageSize.height = Infinity;\n  }\n\n  var size = pageSize2widthAndHeight(pageSize || 'A4');\n\n  if (isNeedSwapPageSizes(pageOrientation)) {\n    // swap page sizes\n    size = {\n      width: size.height,\n      height: size.width\n    };\n  }\n\n  size.orientation = size.width > size.height ? 'landscape' : 'portrait';\n  return size;\n}\n\nfunction fixPageMargins(margin) {\n  if (isNumber(margin)) {\n    margin = {\n      left: margin,\n      right: margin,\n      top: margin,\n      bottom: margin\n    };\n  } else if (isArray(margin)) {\n    if (margin.length === 2) {\n      margin = {\n        left: margin[0],\n        top: margin[1],\n        right: margin[0],\n        bottom: margin[1]\n      };\n    } else if (margin.length === 4) {\n      margin = {\n        left: margin[0],\n        top: margin[1],\n        right: margin[2],\n        bottom: margin[3]\n      };\n    } else {\n      throw 'Invalid pageMargins definition';\n    }\n  }\n\n  return margin;\n}\n\nfunction registerDefaultTableLayouts(layoutBuilder) {\n  layoutBuilder.registerTableLayouts({\n    noBorders: {\n      hLineWidth: function (i) {\n        return 0;\n      },\n      vLineWidth: function (i) {\n        return 0;\n      },\n      paddingLeft: function (i) {\n        return i && 4 || 0;\n      },\n      paddingRight: function (i, node) {\n        return i < node.table.widths.length - 1 ? 4 : 0;\n      }\n    },\n    headerLineOnly: {\n      hLineWidth: function (i, node) {\n        if (i === 0 || i === node.table.body.length) {\n          return 0;\n        }\n\n        return i === node.table.headerRows ? 2 : 0;\n      },\n      vLineWidth: function (i) {\n        return 0;\n      },\n      paddingLeft: function (i) {\n        return i === 0 ? 0 : 8;\n      },\n      paddingRight: function (i, node) {\n        return i === node.table.widths.length - 1 ? 0 : 8;\n      }\n    },\n    lightHorizontalLines: {\n      hLineWidth: function (i, node) {\n        if (i === 0 || i === node.table.body.length) {\n          return 0;\n        }\n\n        return i === node.table.headerRows ? 2 : 1;\n      },\n      vLineWidth: function (i) {\n        return 0;\n      },\n      hLineColor: function (i) {\n        return i === 1 ? 'black' : '#aaa';\n      },\n      paddingLeft: function (i) {\n        return i === 0 ? 0 : 8;\n      },\n      paddingRight: function (i, node) {\n        return i === node.table.widths.length - 1 ? 0 : 8;\n      }\n    }\n  });\n}\n\nfunction pageSize2widthAndHeight(pageSize) {\n  if (isString(pageSize)) {\n    var size = sizes[pageSize.toUpperCase()];\n\n    if (!size) {\n      throw 'Page size ' + pageSize + ' not recognized';\n    }\n\n    return {\n      width: size[0],\n      height: size[1]\n    };\n  }\n\n  return pageSize;\n}\n\nfunction updatePageOrientationInOptions(currentPage, pdfKitDoc) {\n  var previousPageOrientation = pdfKitDoc.options.size[0] > pdfKitDoc.options.size[1] ? 'landscape' : 'portrait';\n\n  if (currentPage.pageSize.orientation !== previousPageOrientation) {\n    var width = pdfKitDoc.options.size[0];\n    var height = pdfKitDoc.options.size[1];\n    pdfKitDoc.options.size = [height, width];\n  }\n}\n\nfunction renderPages(pages, fontProvider, pdfKitDoc, progressCallback) {\n  pdfKitDoc._pdfMakePages = pages;\n  pdfKitDoc.addPage();\n  var totalItems = 0;\n\n  if (progressCallback) {\n    pages.forEach(function (page) {\n      totalItems += page.items.length;\n    });\n  }\n\n  var renderedItems = 0;\n\n  progressCallback = progressCallback || function () {};\n\n  for (var i = 0; i < pages.length; i++) {\n    if (i > 0) {\n      updatePageOrientationInOptions(pages[i], pdfKitDoc);\n      pdfKitDoc.addPage(pdfKitDoc.options);\n    }\n\n    var page = pages[i];\n\n    for (var ii = 0, il = page.items.length; ii < il; ii++) {\n      var item = page.items[ii];\n\n      switch (item.type) {\n        case 'vector':\n          renderVector(item.item, pdfKitDoc);\n          break;\n\n        case 'line':\n          renderLine(item.item, item.item.x, item.item.y, pdfKitDoc);\n          break;\n\n        case 'image':\n          renderImage(item.item, item.item.x, item.item.y, pdfKitDoc);\n          break;\n\n        case 'svg':\n          renderSVG(item.item, item.item.x, item.item.y, pdfKitDoc, fontProvider);\n          break;\n\n        case 'beginClip':\n          beginClip(item.item, pdfKitDoc);\n          break;\n\n        case 'endClip':\n          endClip(pdfKitDoc);\n          break;\n      }\n\n      renderedItems++;\n      progressCallback(renderedItems / totalItems);\n    }\n\n    if (page.watermark) {\n      renderWatermark(page, pdfKitDoc);\n    }\n  }\n}\n/**\r\n * Shift the \"y\" height of the text baseline up or down (superscript or subscript,\r\n * respectively). The exact shift can / should be changed according to standard\r\n * conventions.\r\n *\r\n * @param {number} y\r\n * @param {any} inline\r\n */\n\n\nfunction offsetText(y, inline) {\n  var newY = y;\n\n  if (inline.sup) {\n    newY -= inline.fontSize * 0.75;\n  }\n\n  if (inline.sub) {\n    newY += inline.fontSize * 0.35;\n  }\n\n  return newY;\n}\n\nfunction renderLine(line, x, y, pdfKitDoc) {\n  function preparePageNodeRefLine(_pageNodeRef, inline) {\n    var newWidth;\n    var diffWidth;\n    var textTools = new TextTools(null);\n\n    if (isUndefined(_pageNodeRef.positions)) {\n      throw 'Page reference id not found';\n    }\n\n    var pageNumber = _pageNodeRef.positions[0].pageNumber.toString();\n\n    inline.text = pageNumber;\n    newWidth = textTools.widthOfString(inline.text, inline.font, inline.fontSize, inline.characterSpacing, inline.fontFeatures);\n    diffWidth = inline.width - newWidth;\n    inline.width = newWidth;\n\n    switch (inline.alignment) {\n      case 'right':\n        inline.x += diffWidth;\n        break;\n\n      case 'center':\n        inline.x += diffWidth / 2;\n        break;\n    }\n  }\n\n  if (line._pageNodeRef) {\n    preparePageNodeRefLine(line._pageNodeRef, line.inlines[0]);\n  }\n\n  x = x || 0;\n  y = y || 0;\n  var lineHeight = line.getHeight();\n  var ascenderHeight = line.getAscenderHeight();\n  var descent = lineHeight - ascenderHeight;\n  textDecorator.drawBackground(line, x, y, pdfKitDoc); //TODO: line.optimizeInlines();\n\n  for (var i = 0, l = line.inlines.length; i < l; i++) {\n    var inline = line.inlines[i];\n    var shiftToBaseline = lineHeight - inline.font.ascender / 1000 * inline.fontSize - descent;\n\n    if (inline._pageNodeRef) {\n      preparePageNodeRefLine(inline._pageNodeRef, inline);\n    }\n\n    var options = {\n      lineBreak: false,\n      textWidth: inline.width,\n      characterSpacing: inline.characterSpacing,\n      wordCount: 1,\n      link: inline.link\n    };\n\n    if (inline.linkToDestination) {\n      options.goTo = inline.linkToDestination;\n    }\n\n    if (line.id && i === 0) {\n      options.destination = line.id;\n    }\n\n    if (inline.fontFeatures) {\n      options.features = inline.fontFeatures;\n    }\n\n    var opacity = isNumber(inline.opacity) ? inline.opacity : 1;\n    pdfKitDoc.opacity(opacity);\n    pdfKitDoc.fill(inline.color || 'black');\n    pdfKitDoc._font = inline.font;\n    pdfKitDoc.fontSize(inline.fontSize);\n    var shiftedY = offsetText(y + shiftToBaseline, inline);\n    pdfKitDoc.text(inline.text, x + inline.x, shiftedY, options);\n\n    if (inline.linkToPage) {\n      var _ref = pdfKitDoc.ref({\n        Type: 'Action',\n        S: 'GoTo',\n        D: [inline.linkToPage, 0, 0]\n      }).end();\n\n      pdfKitDoc.annotate(x + inline.x, shiftedY, inline.width, inline.height, {\n        Subtype: 'Link',\n        Dest: [inline.linkToPage - 1, 'XYZ', null, null, null]\n      });\n    }\n  } // Decorations won't draw correctly for superscript\n\n\n  textDecorator.drawDecorations(line, x, y, pdfKitDoc);\n}\n\nfunction renderWatermark(page, pdfKitDoc) {\n  var watermark = page.watermark;\n  pdfKitDoc.fill(watermark.color);\n  pdfKitDoc.opacity(watermark.opacity);\n  pdfKitDoc.save();\n  pdfKitDoc.rotate(watermark.angle, {\n    origin: [pdfKitDoc.page.width / 2, pdfKitDoc.page.height / 2]\n  });\n  var x = pdfKitDoc.page.width / 2 - watermark._size.size.width / 2;\n  var y = pdfKitDoc.page.height / 2 - watermark._size.size.height / 2;\n  pdfKitDoc._font = watermark.font;\n  pdfKitDoc.fontSize(watermark.fontSize);\n  pdfKitDoc.text(watermark.text, x, y, {\n    lineBreak: false\n  });\n  pdfKitDoc.restore();\n}\n\nfunction renderVector(vector, pdfKitDoc) {\n  //TODO: pdf optimization (there's no need to write all properties everytime)\n  pdfKitDoc.lineWidth(vector.lineWidth || 1);\n\n  if (vector.dash) {\n    pdfKitDoc.dash(vector.dash.length, {\n      space: vector.dash.space || vector.dash.length,\n      phase: vector.dash.phase || 0\n    });\n  } else {\n    pdfKitDoc.undash();\n  }\n\n  pdfKitDoc.lineJoin(vector.lineJoin || 'miter');\n  pdfKitDoc.lineCap(vector.lineCap || 'butt'); //TODO: clipping\n\n  var gradient = null;\n\n  switch (vector.type) {\n    case 'ellipse':\n      pdfKitDoc.ellipse(vector.x, vector.y, vector.r1, vector.r2);\n\n      if (vector.linearGradient) {\n        gradient = pdfKitDoc.linearGradient(vector.x - vector.r1, vector.y, vector.x + vector.r1, vector.y);\n      }\n\n      break;\n\n    case 'rect':\n      if (vector.r) {\n        pdfKitDoc.roundedRect(vector.x, vector.y, vector.w, vector.h, vector.r);\n      } else {\n        pdfKitDoc.rect(vector.x, vector.y, vector.w, vector.h);\n      }\n\n      if (vector.linearGradient) {\n        gradient = pdfKitDoc.linearGradient(vector.x, vector.y, vector.x + vector.w, vector.y);\n      }\n\n      break;\n\n    case 'line':\n      pdfKitDoc.moveTo(vector.x1, vector.y1);\n      pdfKitDoc.lineTo(vector.x2, vector.y2);\n      break;\n\n    case 'polyline':\n      if (vector.points.length === 0) {\n        break;\n      }\n\n      pdfKitDoc.moveTo(vector.points[0].x, vector.points[0].y);\n\n      for (var i = 1, l = vector.points.length; i < l; i++) {\n        pdfKitDoc.lineTo(vector.points[i].x, vector.points[i].y);\n      }\n\n      if (vector.points.length > 1) {\n        var p1 = vector.points[0];\n        var pn = vector.points[vector.points.length - 1];\n\n        if (vector.closePath || p1.x === pn.x && p1.y === pn.y) {\n          pdfKitDoc.closePath();\n        }\n      }\n\n      break;\n\n    case 'path':\n      pdfKitDoc.path(vector.d);\n      break;\n  }\n\n  if (vector.linearGradient && gradient) {\n    var step = 1 / (vector.linearGradient.length - 1);\n\n    for (var i = 0; i < vector.linearGradient.length; i++) {\n      gradient.stop(i * step, vector.linearGradient[i]);\n    }\n\n    vector.color = gradient;\n  }\n\n  var fillOpacity = isNumber(vector.fillOpacity) ? vector.fillOpacity : 1;\n  var strokeOpacity = isNumber(vector.strokeOpacity) ? vector.strokeOpacity : 1;\n\n  if (vector.color && vector.lineColor) {\n    pdfKitDoc.fillColor(vector.color, fillOpacity);\n    pdfKitDoc.strokeColor(vector.lineColor, strokeOpacity);\n    pdfKitDoc.fillAndStroke();\n  } else if (vector.color) {\n    pdfKitDoc.fillColor(vector.color, fillOpacity);\n    pdfKitDoc.fill();\n  } else {\n    pdfKitDoc.strokeColor(vector.lineColor || 'black', strokeOpacity);\n    pdfKitDoc.stroke();\n  }\n}\n\nfunction renderImage(image, x, y, pdfKitDoc) {\n  var opacity = isNumber(image.opacity) ? image.opacity : 1;\n  pdfKitDoc.opacity(opacity);\n\n  if (image.cover) {\n    var align = image.cover.align || 'center';\n    var valign = image.cover.valign || 'center';\n    var width = image.cover.width ? image.cover.width : image.width;\n    var height = image.cover.height ? image.cover.height : image.height;\n    pdfKitDoc.save();\n    pdfKitDoc.rect(image.x, image.y, width, height).clip();\n    pdfKitDoc.image(image.image, image.x, image.y, {\n      cover: [width, height],\n      align: align,\n      valign: valign\n    });\n    pdfKitDoc.restore();\n  } else {\n    pdfKitDoc.image(image.image, image.x, image.y, {\n      width: image._width,\n      height: image._height\n    });\n  }\n\n  if (image.link) {\n    pdfKitDoc.link(image.x, image.y, image._width, image._height, image.link);\n  }\n\n  if (image.linkToPage) {\n    pdfKitDoc.ref({\n      Type: 'Action',\n      S: 'GoTo',\n      D: [image.linkToPage, 0, 0]\n    }).end();\n    pdfKitDoc.annotate(image.x, image.y, image._width, image._height, {\n      Subtype: 'Link',\n      Dest: [image.linkToPage - 1, 'XYZ', null, null, null]\n    });\n  }\n\n  if (image.linkToDestination) {\n    pdfKitDoc.goTo(image.x, image.y, image._width, image._height, image.linkToDestination);\n  }\n}\n\nfunction renderSVG(svg, x, y, pdfKitDoc, fontProvider) {\n  var options = Object.assign({\n    width: svg._width,\n    height: svg._height,\n    assumePt: true\n  }, svg.options);\n\n  options.fontCallback = function (family, bold, italic) {\n    var fontsFamily = family.split(',').map(function (f) {\n      return f.trim().replace(/('|\")/g, '');\n    });\n    var font = findFont(fontProvider.fonts, fontsFamily, svg.font || 'Roboto');\n    var fontFile = fontProvider.getFontFile(font, bold, italic);\n\n    if (fontFile === null) {\n      var type = fontProvider.getFontType(bold, italic);\n      throw new Error('Font \\'' + font + '\\' in style \\'' + type + '\\' is not defined in the font section of the document definition.');\n    }\n\n    return fontFile;\n  };\n\n  getSvgToPDF()(pdfKitDoc, svg.svg, svg.x, svg.y, options);\n}\n\nfunction beginClip(rect, pdfKitDoc) {\n  pdfKitDoc.save();\n  pdfKitDoc.addContent('' + rect.x + ' ' + rect.y + ' ' + rect.width + ' ' + rect.height + ' re');\n  pdfKitDoc.clip();\n}\n\nfunction endClip(pdfKitDoc) {\n  pdfKitDoc.restore();\n}\n\nmodule.exports = PdfPrinter;","map":{"version":3,"sources":["/home/julianallende/Desktop/proyecto_sapo/client/node_modules/pdfmake/src/printer.js"],"names":["PdfKitEngine","require","FontProvider","LayoutBuilder","sizes","ImageMeasure","SVGMeasure","textDecorator","TextTools","isFunction","isString","isNumber","isBoolean","isArray","isUndefined","getSvgToPDF","e","Error","findFont","fonts","requiredFonts","defaultFont","i","length","requiredFont","toLowerCase","font","PdfPrinter","fontDescriptors","prototype","createPdfKitDocument","docDefinition","options","version","compress","images","pageMargins","undefined","pageSize","fixPageSize","pageOrientation","pdfOptions","size","width","height","pdfVersion","userPassword","ownerPassword","permissions","fontLayoutCache","bufferPages","autoFirstPage","pdfKitDoc","createPdfDocument","setMetadata","fontProvider","builder","fixPageMargins","registerDefaultTableLayouts","tableLayouts","registerTableLayouts","pages","layoutDocument","content","styles","defaultStyle","fontSize","background","header","footer","watermark","pageBreakBefore","maxNumberPages","maxPagesNumber","slice","Infinity","pageHeight","calculatePageHeight","renderPages","progressCallback","autoPrint","printActionRef","ref","Type","S","N","_root","data","OpenAction","end","standardizePropertyKey","key","standardProperties","standardizedKey","charAt","toUpperCase","indexOf","replace","info","Producer","Creator","value","margins","getItemHeight","item","getHeight","_height","type","y1","y2","getBottomPosition","top","y","fixedMargins","forEach","page","items","bottomPosition","bottom","isNeedSwapPageSizes","pageSize2widthAndHeight","orientation","margin","left","right","layoutBuilder","noBorders","hLineWidth","vLineWidth","paddingLeft","paddingRight","node","table","widths","headerLineOnly","body","headerRows","lightHorizontalLines","hLineColor","updatePageOrientationInOptions","currentPage","previousPageOrientation","_pdfMakePages","addPage","totalItems","renderedItems","ii","il","renderVector","renderLine","x","renderImage","renderSVG","beginClip","endClip","renderWatermark","offsetText","inline","newY","sup","sub","line","preparePageNodeRefLine","_pageNodeRef","newWidth","diffWidth","textTools","positions","pageNumber","toString","text","widthOfString","characterSpacing","fontFeatures","alignment","inlines","lineHeight","ascenderHeight","getAscenderHeight","descent","drawBackground","l","shiftToBaseline","ascender","lineBreak","textWidth","wordCount","link","linkToDestination","goTo","id","destination","features","opacity","fill","color","_font","shiftedY","linkToPage","_ref","D","annotate","Subtype","Dest","drawDecorations","save","rotate","angle","origin","_size","restore","vector","lineWidth","dash","space","phase","undash","lineJoin","lineCap","gradient","ellipse","r1","r2","linearGradient","r","roundedRect","w","h","rect","moveTo","x1","lineTo","x2","points","p1","pn","closePath","path","d","step","stop","fillOpacity","strokeOpacity","lineColor","fillColor","strokeColor","fillAndStroke","stroke","image","cover","align","valign","clip","_width","svg","Object","assign","assumePt","fontCallback","family","bold","italic","fontsFamily","split","map","f","trim","fontFile","getFontFile","getFontType","addContent","module","exports"],"mappings":"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","sourcesContent":["/*eslint no-unused-vars: [\"error\", {\"args\": \"none\"}]*/\r\n'use strict';\r\n\r\nvar PdfKitEngine = require('./pdfKitEngine');\r\nvar FontProvider = require('./fontProvider');\r\nvar LayoutBuilder = require('./layoutBuilder');\r\nvar sizes = require('./standardPageSizes');\r\nvar ImageMeasure = require('./imageMeasure');\r\nvar SVGMeasure = require('./svgMeasure');\r\nvar textDecorator = require('./textDecorator');\r\nvar TextTools = require('./textTools');\r\nvar isFunction = require('./helpers').isFunction;\r\nvar isString = require('./helpers').isString;\r\nvar isNumber = require('./helpers').isNumber;\r\nvar isBoolean = require('./helpers').isBoolean;\r\nvar isArray = require('./helpers').isArray;\r\nvar isUndefined = require('./helpers').isUndefined;\r\n\r\nvar getSvgToPDF = function () {\r\n\ttry {\r\n\t\t// optional dependency to support svg nodes\r\n\t\treturn require('svg-to-pdfkit');\r\n\t} catch (e) {\r\n\t\tthrow new Error('Please install svg-to-pdfkit to enable svg nodes');\r\n\t}\r\n};\r\n\r\nvar findFont = function (fonts, requiredFonts, defaultFont) {\r\n\tfor (var i = 0; i < requiredFonts.length; i++) {\r\n\t\tvar requiredFont = requiredFonts[i].toLowerCase();\r\n\r\n\t\tfor (var font in fonts) {\r\n\t\t\tif (font.toLowerCase() === requiredFont) {\r\n\t\t\t\treturn font;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn defaultFont;\r\n};\r\n\r\n////////////////////////////////////////\r\n// PdfPrinter\r\n\r\n/**\r\n * @class Creates an instance of a PdfPrinter which turns document definition into a pdf\r\n *\r\n * @param {Object} fontDescriptors font definition dictionary\r\n *\r\n * @example\r\n * var fontDescriptors = {\r\n *\tRoboto: {\r\n *\t\tnormal: 'fonts/Roboto-Regular.ttf',\r\n *\t\tbold: 'fonts/Roboto-Medium.ttf',\r\n *\t\titalics: 'fonts/Roboto-Italic.ttf',\r\n *\t\tbolditalics: 'fonts/Roboto-MediumItalic.ttf'\r\n *\t}\r\n * };\r\n *\r\n * var printer = new PdfPrinter(fontDescriptors);\r\n */\r\nfunction PdfPrinter(fontDescriptors) {\r\n\tthis.fontDescriptors = fontDescriptors;\r\n}\r\n\r\n/**\r\n * Executes layout engine for the specified document and renders it into a pdfkit document\r\n * ready to be saved.\r\n *\r\n * @param {Object} docDefinition document definition\r\n * @param {Object} docDefinition.content an array describing the pdf structure (for more information take a look at the examples in the /examples folder)\r\n * @param {Object} [docDefinition.defaultStyle] default (implicit) style definition\r\n * @param {Object} [docDefinition.styles] dictionary defining all styles which can be used in the document\r\n * @param {Object} [docDefinition.pageSize] page size (pdfkit units, A4 dimensions by default)\r\n * @param {Number} docDefinition.pageSize.width width\r\n * @param {Number} docDefinition.pageSize.height height\r\n * @param {Object} [docDefinition.pageMargins] page margins (pdfkit units)\r\n * @param {Number} docDefinition.maxPagesNumber maximum number of pages to render\r\n *\r\n * @example\r\n *\r\n * var docDefinition = {\r\n * \tinfo: {\r\n *\t\ttitle: 'awesome Document',\r\n *\t\tauthor: 'john doe',\r\n *\t\tsubject: 'subject of document',\r\n *\t\tkeywords: 'keywords for document',\r\n * \t},\r\n *\tcontent: [\r\n *\t\t'First paragraph',\r\n *\t\t'Second paragraph, this time a little bit longer',\r\n *\t\t{ text: 'Third paragraph, slightly bigger font size', fontSize: 20 },\r\n *\t\t{ text: 'Another paragraph using a named style', style: 'header' },\r\n *\t\t{ text: ['playing with ', 'inlines' ] },\r\n *\t\t{ text: ['and ', { text: 'restyling ', bold: true }, 'them'] },\r\n *\t],\r\n *\tstyles: {\r\n *\t\theader: { fontSize: 30, bold: true }\r\n *\t}\r\n * }\r\n *\r\n * var pdfKitDoc = printer.createPdfKitDocument(docDefinition);\r\n *\r\n * pdfKitDoc.pipe(fs.createWriteStream('sample.pdf'));\r\n * pdfKitDoc.end();\r\n *\r\n * @return {Object} a pdfKit document object which can be saved or encode to data-url\r\n */\r\nPdfPrinter.prototype.createPdfKitDocument = function (docDefinition, options) {\r\n\toptions = options || {};\r\n\r\n\tdocDefinition.version = docDefinition.version || '1.3';\r\n\tdocDefinition.compress = isBoolean(docDefinition.compress) ? docDefinition.compress : true;\r\n\tdocDefinition.images = docDefinition.images || {};\r\n\tdocDefinition.pageMargins = ((docDefinition.pageMargins !== undefined) && (docDefinition.pageMargins !== null)) ? docDefinition.pageMargins : 40;\r\n\r\n\tvar pageSize = fixPageSize(docDefinition.pageSize, docDefinition.pageOrientation);\r\n\r\n\tvar pdfOptions = {\r\n\t\tsize: [pageSize.width, pageSize.height],\r\n\t\tpdfVersion: docDefinition.version,\r\n\t\tcompress: docDefinition.compress,\r\n\t\tuserPassword: docDefinition.userPassword,\r\n\t\townerPassword: docDefinition.ownerPassword,\r\n\t\tpermissions: docDefinition.permissions,\r\n\t\tfontLayoutCache: isBoolean(options.fontLayoutCache) ? options.fontLayoutCache : true,\r\n\t\tbufferPages: options.bufferPages || false,\r\n\t\tautoFirstPage: false,\r\n\t\tfont: null\r\n\t};\r\n\r\n\tthis.pdfKitDoc = PdfKitEngine.createPdfDocument(pdfOptions);\r\n\tsetMetadata(docDefinition, this.pdfKitDoc);\r\n\r\n\tthis.fontProvider = new FontProvider(this.fontDescriptors, this.pdfKitDoc);\r\n\r\n\tvar builder = new LayoutBuilder(pageSize, fixPageMargins(docDefinition.pageMargins), new ImageMeasure(this.pdfKitDoc, docDefinition.images), new SVGMeasure());\r\n\r\n\tregisterDefaultTableLayouts(builder);\r\n\tif (options.tableLayouts) {\r\n\t\tbuilder.registerTableLayouts(options.tableLayouts);\r\n\t}\r\n\r\n\tvar pages = builder.layoutDocument(docDefinition.content, this.fontProvider, docDefinition.styles || {}, docDefinition.defaultStyle || {\r\n\t\tfontSize: 12,\r\n\t\tfont: 'Roboto'\r\n\t}, docDefinition.background, docDefinition.header, docDefinition.footer, docDefinition.images, docDefinition.watermark, docDefinition.pageBreakBefore);\r\n\tvar maxNumberPages = docDefinition.maxPagesNumber || -1;\r\n\tif (isNumber(maxNumberPages) && maxNumberPages > -1) {\r\n\t\tpages = pages.slice(0, maxNumberPages);\r\n\t}\r\n\r\n\t// if pageSize.height is set to Infinity, calculate the actual height of the page that\r\n\t// was laid out using the height of each of the items in the page.\r\n\tif (pageSize.height === Infinity) {\r\n\t\tvar pageHeight = calculatePageHeight(pages, docDefinition.pageMargins);\r\n\t\tthis.pdfKitDoc.options.size = [pageSize.width, pageHeight];\r\n\t}\r\n\r\n\trenderPages(pages, this.fontProvider, this.pdfKitDoc, options.progressCallback);\r\n\r\n\tif (options.autoPrint) {\r\n\t\tvar printActionRef = this.pdfKitDoc.ref({\r\n\t\t\tType: 'Action',\r\n\t\t\tS: 'Named',\r\n\t\t\tN: 'Print'\r\n\t\t});\r\n\t\tthis.pdfKitDoc._root.data.OpenAction = printActionRef;\r\n\t\tprintActionRef.end();\r\n\t}\r\n\treturn this.pdfKitDoc;\r\n};\r\n\r\nfunction setMetadata(docDefinition, pdfKitDoc) {\r\n\t// PDF standard has these properties reserved: Title, Author, Subject, Keywords,\r\n\t// Creator, Producer, CreationDate, ModDate, Trapped.\r\n\t// To keep the pdfmake api consistent, the info field are defined lowercase.\r\n\t// Custom properties don't contain a space.\r\n\tfunction standardizePropertyKey(key) {\r\n\t\tvar standardProperties = ['Title', 'Author', 'Subject', 'Keywords',\r\n\t\t\t'Creator', 'Producer', 'CreationDate', 'ModDate', 'Trapped'];\r\n\t\tvar standardizedKey = key.charAt(0).toUpperCase() + key.slice(1);\r\n\t\tif (standardProperties.indexOf(standardizedKey) !== -1) {\r\n\t\t\treturn standardizedKey;\r\n\t\t}\r\n\r\n\t\treturn key.replace(/\\s+/g, '');\r\n\t}\r\n\r\n\tpdfKitDoc.info.Producer = 'pdfmake';\r\n\tpdfKitDoc.info.Creator = 'pdfmake';\r\n\r\n\tif (docDefinition.info) {\r\n\t\tfor (var key in docDefinition.info) {\r\n\t\t\tvar value = docDefinition.info[key];\r\n\t\t\tif (value) {\r\n\t\t\t\tkey = standardizePropertyKey(key);\r\n\t\t\t\tpdfKitDoc.info[key] = value;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction calculatePageHeight(pages, margins) {\r\n\tfunction getItemHeight(item) {\r\n\t\tif (isFunction(item.item.getHeight)) {\r\n\t\t\treturn item.item.getHeight();\r\n\t\t} else if (item.item._height) {\r\n\t\t\treturn item.item._height;\r\n\t\t} else if (item.type === 'vector') {\r\n\t\t\treturn item.item.y1 > item.item.y2 ? item.item.y1 : item.item.y2;\r\n\t\t} else {\r\n\t\t\t// TODO: add support for next item types\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getBottomPosition(item) {\r\n\t\tvar top = item.item.y || 0;\r\n\t\tvar height = getItemHeight(item);\r\n\t\treturn top + height;\r\n\t}\r\n\r\n\tvar fixedMargins = fixPageMargins(margins || 40);\r\n\tvar height = fixedMargins.top;\r\n\r\n\tpages.forEach(function (page) {\r\n\t\tpage.items.forEach(function (item) {\r\n\t\t\tvar bottomPosition = getBottomPosition(item);\r\n\t\t\tif (bottomPosition > height) {\r\n\t\t\t\theight = bottomPosition;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\theight += fixedMargins.bottom;\r\n\r\n\treturn height;\r\n}\r\n\r\nfunction fixPageSize(pageSize, pageOrientation) {\r\n\tfunction isNeedSwapPageSizes(pageOrientation) {\r\n\t\tif (isString(pageOrientation)) {\r\n\t\t\tpageOrientation = pageOrientation.toLowerCase();\r\n\t\t\treturn ((pageOrientation === 'portrait') && (size.width > size.height)) ||\r\n\t\t\t\t((pageOrientation === 'landscape') && (size.width < size.height));\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// if pageSize.height is set to auto, set the height to infinity so there are no page breaks.\r\n\tif (pageSize && pageSize.height === 'auto') {\r\n\t\tpageSize.height = Infinity;\r\n\t}\r\n\r\n\tvar size = pageSize2widthAndHeight(pageSize || 'A4');\r\n\tif (isNeedSwapPageSizes(pageOrientation)) { // swap page sizes\r\n\t\tsize = { width: size.height, height: size.width };\r\n\t}\r\n\tsize.orientation = size.width > size.height ? 'landscape' : 'portrait';\r\n\treturn size;\r\n}\r\n\r\nfunction fixPageMargins(margin) {\r\n\tif (isNumber(margin)) {\r\n\t\tmargin = { left: margin, right: margin, top: margin, bottom: margin };\r\n\t} else if (isArray(margin)) {\r\n\t\tif (margin.length === 2) {\r\n\t\t\tmargin = { left: margin[0], top: margin[1], right: margin[0], bottom: margin[1] };\r\n\t\t} else if (margin.length === 4) {\r\n\t\t\tmargin = { left: margin[0], top: margin[1], right: margin[2], bottom: margin[3] };\r\n\t\t} else {\r\n\t\t\tthrow 'Invalid pageMargins definition';\r\n\t\t}\r\n\t}\r\n\r\n\treturn margin;\r\n}\r\n\r\nfunction registerDefaultTableLayouts(layoutBuilder) {\r\n\tlayoutBuilder.registerTableLayouts({\r\n\t\tnoBorders: {\r\n\t\t\thLineWidth: function (i) {\r\n\t\t\t\treturn 0;\r\n\t\t\t},\r\n\t\t\tvLineWidth: function (i) {\r\n\t\t\t\treturn 0;\r\n\t\t\t},\r\n\t\t\tpaddingLeft: function (i) {\r\n\t\t\t\treturn i && 4 || 0;\r\n\t\t\t},\r\n\t\t\tpaddingRight: function (i, node) {\r\n\t\t\t\treturn (i < node.table.widths.length - 1) ? 4 : 0;\r\n\t\t\t}\r\n\t\t},\r\n\t\theaderLineOnly: {\r\n\t\t\thLineWidth: function (i, node) {\r\n\t\t\t\tif (i === 0 || i === node.table.body.length) {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t\treturn (i === node.table.headerRows) ? 2 : 0;\r\n\t\t\t},\r\n\t\t\tvLineWidth: function (i) {\r\n\t\t\t\treturn 0;\r\n\t\t\t},\r\n\t\t\tpaddingLeft: function (i) {\r\n\t\t\t\treturn i === 0 ? 0 : 8;\r\n\t\t\t},\r\n\t\t\tpaddingRight: function (i, node) {\r\n\t\t\t\treturn (i === node.table.widths.length - 1) ? 0 : 8;\r\n\t\t\t}\r\n\t\t},\r\n\t\tlightHorizontalLines: {\r\n\t\t\thLineWidth: function (i, node) {\r\n\t\t\t\tif (i === 0 || i === node.table.body.length) {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t\treturn (i === node.table.headerRows) ? 2 : 1;\r\n\t\t\t},\r\n\t\t\tvLineWidth: function (i) {\r\n\t\t\t\treturn 0;\r\n\t\t\t},\r\n\t\t\thLineColor: function (i) {\r\n\t\t\t\treturn i === 1 ? 'black' : '#aaa';\r\n\t\t\t},\r\n\t\t\tpaddingLeft: function (i) {\r\n\t\t\t\treturn i === 0 ? 0 : 8;\r\n\t\t\t},\r\n\t\t\tpaddingRight: function (i, node) {\r\n\t\t\t\treturn (i === node.table.widths.length - 1) ? 0 : 8;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction pageSize2widthAndHeight(pageSize) {\r\n\tif (isString(pageSize)) {\r\n\t\tvar size = sizes[pageSize.toUpperCase()];\r\n\t\tif (!size) {\r\n\t\t\tthrow 'Page size ' + pageSize + ' not recognized';\r\n\t\t}\r\n\t\treturn { width: size[0], height: size[1] };\r\n\t}\r\n\r\n\treturn pageSize;\r\n}\r\n\r\nfunction updatePageOrientationInOptions(currentPage, pdfKitDoc) {\r\n\tvar previousPageOrientation = pdfKitDoc.options.size[0] > pdfKitDoc.options.size[1] ? 'landscape' : 'portrait';\r\n\r\n\tif (currentPage.pageSize.orientation !== previousPageOrientation) {\r\n\t\tvar width = pdfKitDoc.options.size[0];\r\n\t\tvar height = pdfKitDoc.options.size[1];\r\n\t\tpdfKitDoc.options.size = [height, width];\r\n\t}\r\n}\r\n\r\nfunction renderPages(pages, fontProvider, pdfKitDoc, progressCallback) {\r\n\tpdfKitDoc._pdfMakePages = pages;\r\n\tpdfKitDoc.addPage();\r\n\r\n\tvar totalItems = 0;\r\n\tif (progressCallback) {\r\n\t\tpages.forEach(function (page) {\r\n\t\t\ttotalItems += page.items.length;\r\n\t\t});\r\n\t}\r\n\r\n\tvar renderedItems = 0;\r\n\tprogressCallback = progressCallback || function () {\r\n\t};\r\n\r\n\tfor (var i = 0; i < pages.length; i++) {\r\n\t\tif (i > 0) {\r\n\t\t\tupdatePageOrientationInOptions(pages[i], pdfKitDoc);\r\n\t\t\tpdfKitDoc.addPage(pdfKitDoc.options);\r\n\t\t}\r\n\r\n\t\tvar page = pages[i];\r\n\t\tfor (var ii = 0, il = page.items.length; ii < il; ii++) {\r\n\t\t\tvar item = page.items[ii];\r\n\t\t\tswitch (item.type) {\r\n\t\t\t\tcase 'vector':\r\n\t\t\t\t\trenderVector(item.item, pdfKitDoc);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'line':\r\n\t\t\t\t\trenderLine(item.item, item.item.x, item.item.y, pdfKitDoc);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'image':\r\n\t\t\t\t\trenderImage(item.item, item.item.x, item.item.y, pdfKitDoc);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'svg':\r\n\t\t\t\t\trenderSVG(item.item, item.item.x, item.item.y, pdfKitDoc, fontProvider);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'beginClip':\r\n\t\t\t\t\tbeginClip(item.item, pdfKitDoc);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'endClip':\r\n\t\t\t\t\tendClip(pdfKitDoc);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\trenderedItems++;\r\n\t\t\tprogressCallback(renderedItems / totalItems);\r\n\t\t}\r\n\t\tif (page.watermark) {\r\n\t\t\trenderWatermark(page, pdfKitDoc);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Shift the \"y\" height of the text baseline up or down (superscript or subscript,\r\n * respectively). The exact shift can / should be changed according to standard\r\n * conventions.\r\n *\r\n * @param {number} y\r\n * @param {any} inline\r\n */\r\nfunction offsetText(y, inline) {\r\n\tvar newY = y;\r\n\tif (inline.sup) {\r\n\t\tnewY -= inline.fontSize * 0.75;\r\n\t}\r\n\tif (inline.sub) {\r\n\t\tnewY += inline.fontSize * 0.35;\r\n\t}\r\n\treturn newY;\r\n}\r\n\r\nfunction renderLine(line, x, y, pdfKitDoc) {\r\n\tfunction preparePageNodeRefLine(_pageNodeRef, inline) {\r\n\t\tvar newWidth;\r\n\t\tvar diffWidth;\r\n\t\tvar textTools = new TextTools(null);\r\n\r\n\t\tif (isUndefined(_pageNodeRef.positions)) {\r\n\t\t\tthrow 'Page reference id not found';\r\n\t\t}\r\n\r\n\t\tvar pageNumber = _pageNodeRef.positions[0].pageNumber.toString();\r\n\r\n\t\tinline.text = pageNumber;\r\n\t\tnewWidth = textTools.widthOfString(inline.text, inline.font, inline.fontSize, inline.characterSpacing, inline.fontFeatures);\r\n\t\tdiffWidth = inline.width - newWidth;\r\n\t\tinline.width = newWidth;\r\n\r\n\t\tswitch (inline.alignment) {\r\n\t\t\tcase 'right':\r\n\t\t\t\tinline.x += diffWidth;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'center':\r\n\t\t\t\tinline.x += diffWidth / 2;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tif (line._pageNodeRef) {\r\n\t\tpreparePageNodeRefLine(line._pageNodeRef, line.inlines[0]);\r\n\t}\r\n\r\n\tx = x || 0;\r\n\ty = y || 0;\r\n\r\n\tvar lineHeight = line.getHeight();\r\n\tvar ascenderHeight = line.getAscenderHeight();\r\n\tvar descent = lineHeight - ascenderHeight;\r\n\r\n\ttextDecorator.drawBackground(line, x, y, pdfKitDoc);\r\n\r\n\t//TODO: line.optimizeInlines();\r\n\tfor (var i = 0, l = line.inlines.length; i < l; i++) {\r\n\t\tvar inline = line.inlines[i];\r\n\t\tvar shiftToBaseline = lineHeight - ((inline.font.ascender / 1000) * inline.fontSize) - descent;\r\n\r\n\t\tif (inline._pageNodeRef) {\r\n\t\t\tpreparePageNodeRefLine(inline._pageNodeRef, inline);\r\n\t\t}\r\n\r\n\t\tvar options = {\r\n\t\t\tlineBreak: false,\r\n\t\t\ttextWidth: inline.width,\r\n\t\t\tcharacterSpacing: inline.characterSpacing,\r\n\t\t\twordCount: 1,\r\n\t\t\tlink: inline.link\r\n\t\t};\r\n\r\n\t\tif (inline.linkToDestination) {\r\n\t\t\toptions.goTo = inline.linkToDestination;\r\n\t\t}\r\n\r\n\t\tif (line.id && i === 0) {\r\n\t\t\toptions.destination = line.id;\r\n\t\t}\r\n\r\n\t\tif (inline.fontFeatures) {\r\n\t\t\toptions.features = inline.fontFeatures;\r\n\t\t}\r\n\r\n\t\tvar opacity = isNumber(inline.opacity) ? inline.opacity : 1;\r\n\t\tpdfKitDoc.opacity(opacity);\r\n\t\tpdfKitDoc.fill(inline.color || 'black');\r\n\r\n\t\tpdfKitDoc._font = inline.font;\r\n\t\tpdfKitDoc.fontSize(inline.fontSize);\r\n\r\n\t\tvar shiftedY = offsetText(y + shiftToBaseline, inline);\r\n\t\tpdfKitDoc.text(inline.text, x + inline.x, shiftedY, options);\r\n\r\n\t\tif (inline.linkToPage) {\r\n\t\t\tvar _ref = pdfKitDoc.ref({ Type: 'Action', S: 'GoTo', D: [inline.linkToPage, 0, 0] }).end();\r\n\t\t\tpdfKitDoc.annotate(x + inline.x, shiftedY, inline.width, inline.height, {\r\n\t\t\t\tSubtype: 'Link',\r\n\t\t\t\tDest: [inline.linkToPage - 1, 'XYZ', null, null, null]\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n\t// Decorations won't draw correctly for superscript\r\n\ttextDecorator.drawDecorations(line, x, y, pdfKitDoc);\r\n}\r\n\r\nfunction renderWatermark(page, pdfKitDoc) {\r\n\tvar watermark = page.watermark;\r\n\r\n\tpdfKitDoc.fill(watermark.color);\r\n\tpdfKitDoc.opacity(watermark.opacity);\r\n\r\n\tpdfKitDoc.save();\r\n\r\n\tpdfKitDoc.rotate(watermark.angle, { origin: [pdfKitDoc.page.width / 2, pdfKitDoc.page.height / 2] });\r\n\r\n\tvar x = pdfKitDoc.page.width / 2 - watermark._size.size.width / 2;\r\n\tvar y = pdfKitDoc.page.height / 2 - watermark._size.size.height / 2;\r\n\r\n\tpdfKitDoc._font = watermark.font;\r\n\tpdfKitDoc.fontSize(watermark.fontSize);\r\n\tpdfKitDoc.text(watermark.text, x, y, { lineBreak: false });\r\n\r\n\tpdfKitDoc.restore();\r\n}\r\n\r\nfunction renderVector(vector, pdfKitDoc) {\r\n\t//TODO: pdf optimization (there's no need to write all properties everytime)\r\n\tpdfKitDoc.lineWidth(vector.lineWidth || 1);\r\n\tif (vector.dash) {\r\n\t\tpdfKitDoc.dash(vector.dash.length, { space: vector.dash.space || vector.dash.length, phase: vector.dash.phase || 0 });\r\n\t} else {\r\n\t\tpdfKitDoc.undash();\r\n\t}\r\n\tpdfKitDoc.lineJoin(vector.lineJoin || 'miter');\r\n\tpdfKitDoc.lineCap(vector.lineCap || 'butt');\r\n\r\n\t//TODO: clipping\r\n\r\n\tvar gradient = null;\r\n\r\n\tswitch (vector.type) {\r\n\t\tcase 'ellipse':\r\n\t\t\tpdfKitDoc.ellipse(vector.x, vector.y, vector.r1, vector.r2);\r\n\r\n\t\t\tif (vector.linearGradient) {\r\n\t\t\t\tgradient = pdfKitDoc.linearGradient(vector.x - vector.r1, vector.y, vector.x + vector.r1, vector.y);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 'rect':\r\n\t\t\tif (vector.r) {\r\n\t\t\t\tpdfKitDoc.roundedRect(vector.x, vector.y, vector.w, vector.h, vector.r);\r\n\t\t\t} else {\r\n\t\t\t\tpdfKitDoc.rect(vector.x, vector.y, vector.w, vector.h);\r\n\t\t\t}\r\n\r\n\t\t\tif (vector.linearGradient) {\r\n\t\t\t\tgradient = pdfKitDoc.linearGradient(vector.x, vector.y, vector.x + vector.w, vector.y);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 'line':\r\n\t\t\tpdfKitDoc.moveTo(vector.x1, vector.y1);\r\n\t\t\tpdfKitDoc.lineTo(vector.x2, vector.y2);\r\n\t\t\tbreak;\r\n\t\tcase 'polyline':\r\n\t\t\tif (vector.points.length === 0) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tpdfKitDoc.moveTo(vector.points[0].x, vector.points[0].y);\r\n\t\t\tfor (var i = 1, l = vector.points.length; i < l; i++) {\r\n\t\t\t\tpdfKitDoc.lineTo(vector.points[i].x, vector.points[i].y);\r\n\t\t\t}\r\n\r\n\t\t\tif (vector.points.length > 1) {\r\n\t\t\t\tvar p1 = vector.points[0];\r\n\t\t\t\tvar pn = vector.points[vector.points.length - 1];\r\n\r\n\t\t\t\tif (vector.closePath || p1.x === pn.x && p1.y === pn.y) {\r\n\t\t\t\t\tpdfKitDoc.closePath();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 'path':\r\n\t\t\tpdfKitDoc.path(vector.d);\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\tif (vector.linearGradient && gradient) {\r\n\t\tvar step = 1 / (vector.linearGradient.length - 1);\r\n\r\n\t\tfor (var i = 0; i < vector.linearGradient.length; i++) {\r\n\t\t\tgradient.stop(i * step, vector.linearGradient[i]);\r\n\t\t}\r\n\r\n\t\tvector.color = gradient;\r\n\t}\r\n\r\n\tvar fillOpacity = isNumber(vector.fillOpacity) ? vector.fillOpacity : 1;\r\n\tvar strokeOpacity = isNumber(vector.strokeOpacity) ? vector.strokeOpacity : 1;\r\n\r\n\tif (vector.color && vector.lineColor) {\r\n\t\tpdfKitDoc.fillColor(vector.color, fillOpacity);\r\n\t\tpdfKitDoc.strokeColor(vector.lineColor, strokeOpacity);\r\n\t\tpdfKitDoc.fillAndStroke();\r\n\t} else if (vector.color) {\r\n\t\tpdfKitDoc.fillColor(vector.color, fillOpacity);\r\n\t\tpdfKitDoc.fill();\r\n\t} else {\r\n\t\tpdfKitDoc.strokeColor(vector.lineColor || 'black', strokeOpacity);\r\n\t\tpdfKitDoc.stroke();\r\n\t}\r\n}\r\n\r\nfunction renderImage(image, x, y, pdfKitDoc) {\r\n\tvar opacity = isNumber(image.opacity) ? image.opacity : 1;\r\n\tpdfKitDoc.opacity(opacity);\r\n\tif (image.cover) {\r\n\t\tvar align = image.cover.align || 'center';\r\n\t\tvar valign = image.cover.valign || 'center';\r\n\t\tvar width = image.cover.width ? image.cover.width : image.width;\r\n\t\tvar height = image.cover.height ? image.cover.height : image.height;\r\n\t\tpdfKitDoc.save();\r\n\t\tpdfKitDoc.rect(image.x, image.y, width, height).clip();\r\n\t\tpdfKitDoc.image(image.image, image.x, image.y, { cover: [width, height], align: align, valign: valign });\r\n\t\tpdfKitDoc.restore();\r\n\t} else {\r\n\t\tpdfKitDoc.image(image.image, image.x, image.y, { width: image._width, height: image._height });\r\n\t}\r\n\tif (image.link) {\r\n\t\tpdfKitDoc.link(image.x, image.y, image._width, image._height, image.link);\r\n\t}\r\n\tif (image.linkToPage) {\r\n\t\tpdfKitDoc.ref({ Type: 'Action', S: 'GoTo', D: [image.linkToPage, 0, 0] }).end();\r\n\t\tpdfKitDoc.annotate(image.x, image.y, image._width, image._height, { Subtype: 'Link', Dest: [image.linkToPage - 1, 'XYZ', null, null, null] });\r\n\t}\r\n\tif (image.linkToDestination) {\r\n\t\tpdfKitDoc.goTo(image.x, image.y, image._width, image._height, image.linkToDestination);\r\n\t}\r\n}\r\n\r\nfunction renderSVG(svg, x, y, pdfKitDoc, fontProvider) {\r\n\tvar options = Object.assign({ width: svg._width, height: svg._height, assumePt: true }, svg.options);\r\n\toptions.fontCallback = function (family, bold, italic) {\r\n\t\tvar fontsFamily = family.split(',').map(function (f) { return f.trim().replace(/('|\")/g, ''); });\r\n\t\tvar font = findFont(fontProvider.fonts, fontsFamily, svg.font || 'Roboto');\r\n\r\n\t\tvar fontFile = fontProvider.getFontFile(font, bold, italic);\r\n\t\tif (fontFile === null) {\r\n\t\t\tvar type = fontProvider.getFontType(bold, italic);\r\n\t\t\tthrow new Error('Font \\'' + font + '\\' in style \\'' + type + '\\' is not defined in the font section of the document definition.');\r\n\t\t}\r\n\r\n\t\treturn fontFile;\r\n\t};\r\n\r\n\tgetSvgToPDF()(pdfKitDoc, svg.svg, svg.x, svg.y, options);\r\n}\r\n\r\nfunction beginClip(rect, pdfKitDoc) {\r\n\tpdfKitDoc.save();\r\n\tpdfKitDoc.addContent('' + rect.x + ' ' + rect.y + ' ' + rect.width + ' ' + rect.height + ' re');\r\n\tpdfKitDoc.clip();\r\n}\r\n\r\nfunction endClip(pdfKitDoc) {\r\n\tpdfKitDoc.restore();\r\n}\r\n\r\nmodule.exports = PdfPrinter;\r\n"]},"metadata":{},"sourceType":"script"}