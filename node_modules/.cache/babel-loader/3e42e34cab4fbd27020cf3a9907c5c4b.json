{"ast":null,"code":"'use strict';\n\nvar isString = require('./helpers').isString;\n\nvar isNumber = require('./helpers').isNumber;\n\nvar isBoolean = require('./helpers').isBoolean;\n\nvar isArray = require('./helpers').isArray;\n\nvar isUndefined = require('./helpers').isUndefined;\n\nvar fontStringify = require('./helpers').fontStringify;\n\nfunction DocPreprocessor() {}\n\nDocPreprocessor.prototype.preprocessDocument = function (docStructure) {\n  this.parentNode = null;\n  this.tocs = [];\n  this.nodeReferences = [];\n  return this.preprocessNode(docStructure);\n};\n\nDocPreprocessor.prototype.preprocessNode = function (node) {\n  // expand shortcuts and casting values\n  if (isArray(node)) {\n    node = {\n      stack: node\n    };\n  } else if (isString(node)) {\n    node = {\n      text: node\n    };\n  } else if (isNumber(node) || isBoolean(node)) {\n    node = {\n      text: node.toString()\n    };\n  } else if (node === undefined || node === null) {\n    node = {\n      text: ''\n    };\n  } else if (Object.keys(node).length === 0) {\n    // empty object\n    node = {\n      text: ''\n    };\n  } else if ('text' in node && (node.text === undefined || node.text === null)) {\n    node.text = '';\n  }\n\n  if (node.columns) {\n    return this.preprocessColumns(node);\n  } else if (node.stack) {\n    return this.preprocessVerticalContainer(node);\n  } else if (node.ul) {\n    return this.preprocessList(node);\n  } else if (node.ol) {\n    return this.preprocessList(node);\n  } else if (node.table) {\n    return this.preprocessTable(node);\n  } else if (node.text !== undefined) {\n    return this.preprocessText(node);\n  } else if (node.toc) {\n    return this.preprocessToc(node);\n  } else if (node.image) {\n    return this.preprocessImage(node);\n  } else if (node.svg) {\n    return this.preprocessSVG(node);\n  } else if (node.canvas) {\n    return this.preprocessCanvas(node);\n  } else if (node.qr) {\n    return this.preprocessQr(node);\n  } else if (node.pageReference || node.textReference) {\n    return this.preprocessText(node);\n  } else {\n    throw 'Unrecognized document structure: ' + JSON.stringify(node, fontStringify);\n  }\n};\n\nDocPreprocessor.prototype.preprocessColumns = function (node) {\n  var columns = node.columns;\n\n  for (var i = 0, l = columns.length; i < l; i++) {\n    columns[i] = this.preprocessNode(columns[i]);\n  }\n\n  return node;\n};\n\nDocPreprocessor.prototype.preprocessVerticalContainer = function (node) {\n  var items = node.stack;\n\n  for (var i = 0, l = items.length; i < l; i++) {\n    items[i] = this.preprocessNode(items[i]);\n  }\n\n  return node;\n};\n\nDocPreprocessor.prototype.preprocessList = function (node) {\n  var items = node.ul || node.ol;\n\n  for (var i = 0, l = items.length; i < l; i++) {\n    items[i] = this.preprocessNode(items[i]);\n  }\n\n  return node;\n};\n\nDocPreprocessor.prototype.preprocessTable = function (node) {\n  var col, row, cols, rows;\n\n  for (col = 0, cols = node.table.body[0].length; col < cols; col++) {\n    for (row = 0, rows = node.table.body.length; row < rows; row++) {\n      var rowData = node.table.body[row];\n      var data = rowData[col];\n\n      if (data !== undefined) {\n        if (data === null) {\n          // transform to object\n          data = '';\n        }\n\n        if (!data._span) {\n          rowData[col] = this.preprocessNode(data);\n        }\n      }\n    }\n  }\n\n  return node;\n};\n\nDocPreprocessor.prototype.preprocessText = function (node) {\n  if (node.tocItem) {\n    if (!isArray(node.tocItem)) {\n      node.tocItem = [node.tocItem];\n    }\n\n    for (var i = 0, l = node.tocItem.length; i < l; i++) {\n      if (!isString(node.tocItem[i])) {\n        node.tocItem[i] = '_default_';\n      }\n\n      var tocItemId = node.tocItem[i];\n\n      if (!this.tocs[tocItemId]) {\n        this.tocs[tocItemId] = {\n          toc: {\n            _items: [],\n            _pseudo: true\n          }\n        };\n      }\n\n      if (!node.id) {\n        node.id = 'toc-' + tocItemId + '-' + this.tocs[tocItemId].toc._items.length;\n      }\n\n      var tocItemRef = {\n        _nodeRef: this._getNodeForNodeRef(node),\n        _textNodeRef: node\n      };\n\n      this.tocs[tocItemId].toc._items.push(tocItemRef);\n    }\n  }\n\n  if (node.id) {\n    if (this.nodeReferences[node.id]) {\n      if (!this.nodeReferences[node.id]._pseudo) {\n        throw \"Node id '\" + node.id + \"' already exists\";\n      }\n\n      this.nodeReferences[node.id]._nodeRef = this._getNodeForNodeRef(node);\n      this.nodeReferences[node.id]._textNodeRef = node;\n      this.nodeReferences[node.id]._pseudo = false;\n    } else {\n      this.nodeReferences[node.id] = {\n        _nodeRef: this._getNodeForNodeRef(node),\n        _textNodeRef: node\n      };\n    }\n  }\n\n  if (node.pageReference) {\n    if (!this.nodeReferences[node.pageReference]) {\n      this.nodeReferences[node.pageReference] = {\n        _nodeRef: {},\n        _textNodeRef: {},\n        _pseudo: true\n      };\n    }\n\n    node.text = '00000';\n    node.linkToDestination = node.pageReference;\n    node._pageRef = this.nodeReferences[node.pageReference];\n  }\n\n  if (node.textReference) {\n    if (!this.nodeReferences[node.textReference]) {\n      this.nodeReferences[node.textReference] = {\n        _nodeRef: {},\n        _pseudo: true\n      };\n    }\n\n    node.text = '';\n    node.linkToDestination = node.textReference;\n    node._textRef = this.nodeReferences[node.textReference];\n  }\n\n  if (node.text && node.text.text) {\n    node.text = [this.preprocessNode(node.text)];\n  } else if (isArray(node.text)) {\n    var isSetParentNode = false;\n\n    if (this.parentNode === null) {\n      this.parentNode = node;\n      isSetParentNode = true;\n    }\n\n    for (var i = 0, l = node.text.length; i < l; i++) {\n      node.text[i] = this.preprocessNode(node.text[i]);\n    }\n\n    if (isSetParentNode) {\n      this.parentNode = null;\n    }\n  }\n\n  return node;\n};\n\nDocPreprocessor.prototype.preprocessToc = function (node) {\n  if (!node.toc.id) {\n    node.toc.id = '_default_';\n  }\n\n  node.toc.title = node.toc.title ? this.preprocessNode(node.toc.title) : null;\n  node.toc._items = [];\n\n  if (this.tocs[node.toc.id]) {\n    if (!this.tocs[node.toc.id].toc._pseudo) {\n      throw \"TOC '\" + node.toc.id + \"' already exists\";\n    }\n\n    node.toc._items = this.tocs[node.toc.id].toc._items;\n  }\n\n  this.tocs[node.toc.id] = node;\n  return node;\n};\n\nDocPreprocessor.prototype.preprocessImage = function (node) {\n  if (!isUndefined(node.image.type) && !isUndefined(node.image.data) && node.image.type === 'Buffer' && isArray(node.image.data)) {\n    node.image = Buffer.from(node.image.data);\n  }\n\n  return node;\n};\n\nDocPreprocessor.prototype.preprocessSVG = function (node) {\n  return node;\n};\n\nDocPreprocessor.prototype.preprocessCanvas = function (node) {\n  return node;\n};\n\nDocPreprocessor.prototype.preprocessQr = function (node) {\n  return node;\n};\n\nDocPreprocessor.prototype._getNodeForNodeRef = function (node) {\n  if (this.parentNode) {\n    return this.parentNode;\n  }\n\n  return node;\n};\n\nmodule.exports = DocPreprocessor;","map":{"version":3,"sources":["/home/julianallende/Desktop/proyecto_sapo/client/node_modules/pdfmake/src/docPreprocessor.js"],"names":["isString","require","isNumber","isBoolean","isArray","isUndefined","fontStringify","DocPreprocessor","prototype","preprocessDocument","docStructure","parentNode","tocs","nodeReferences","preprocessNode","node","stack","text","toString","undefined","Object","keys","length","columns","preprocessColumns","preprocessVerticalContainer","ul","preprocessList","ol","table","preprocessTable","preprocessText","toc","preprocessToc","image","preprocessImage","svg","preprocessSVG","canvas","preprocessCanvas","qr","preprocessQr","pageReference","textReference","JSON","stringify","i","l","items","col","row","cols","rows","body","rowData","data","_span","tocItem","tocItemId","_items","_pseudo","id","tocItemRef","_nodeRef","_getNodeForNodeRef","_textNodeRef","push","linkToDestination","_pageRef","_textRef","isSetParentNode","title","type","Buffer","from","module","exports"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nvar isString = require('./helpers').isString;\r\nvar isNumber = require('./helpers').isNumber;\r\nvar isBoolean = require('./helpers').isBoolean;\r\nvar isArray = require('./helpers').isArray;\r\nvar isUndefined = require('./helpers').isUndefined;\r\nvar fontStringify = require('./helpers').fontStringify;\r\n\r\nfunction DocPreprocessor() {\r\n\r\n}\r\n\r\nDocPreprocessor.prototype.preprocessDocument = function (docStructure) {\r\n\tthis.parentNode = null;\r\n\tthis.tocs = [];\r\n\tthis.nodeReferences = [];\r\n\treturn this.preprocessNode(docStructure);\r\n};\r\n\r\nDocPreprocessor.prototype.preprocessNode = function (node) {\r\n\t// expand shortcuts and casting values\r\n\tif (isArray(node)) {\r\n\t\tnode = { stack: node };\r\n\t} else if (isString(node)) {\r\n\t\tnode = { text: node };\r\n\t} else if (isNumber(node) || isBoolean(node)) {\r\n\t\tnode = { text: node.toString() };\r\n\t} else if (node === undefined || node === null) {\r\n\t\tnode = { text: '' };\r\n\t} else if (Object.keys(node).length === 0) { // empty object\r\n\t\tnode = { text: '' };\r\n\t} else if ('text' in node && (node.text === undefined || node.text === null)) {\r\n\t\tnode.text = '';\r\n\t}\r\n\r\n\tif (node.columns) {\r\n\t\treturn this.preprocessColumns(node);\r\n\t} else if (node.stack) {\r\n\t\treturn this.preprocessVerticalContainer(node);\r\n\t} else if (node.ul) {\r\n\t\treturn this.preprocessList(node);\r\n\t} else if (node.ol) {\r\n\t\treturn this.preprocessList(node);\r\n\t} else if (node.table) {\r\n\t\treturn this.preprocessTable(node);\r\n\t} else if (node.text !== undefined) {\r\n\t\treturn this.preprocessText(node);\r\n\t} else if (node.toc) {\r\n\t\treturn this.preprocessToc(node);\r\n\t} else if (node.image) {\r\n\t\treturn this.preprocessImage(node);\r\n\t} else if (node.svg) {\r\n\t\treturn this.preprocessSVG(node);\r\n\t} else if (node.canvas) {\r\n\t\treturn this.preprocessCanvas(node);\r\n\t} else if (node.qr) {\r\n\t\treturn this.preprocessQr(node);\r\n\t} else if (node.pageReference || node.textReference) {\r\n\t\treturn this.preprocessText(node);\r\n\t} else {\r\n\t\tthrow 'Unrecognized document structure: ' + JSON.stringify(node, fontStringify);\r\n\t}\r\n};\r\n\r\nDocPreprocessor.prototype.preprocessColumns = function (node) {\r\n\tvar columns = node.columns;\r\n\r\n\tfor (var i = 0, l = columns.length; i < l; i++) {\r\n\t\tcolumns[i] = this.preprocessNode(columns[i]);\r\n\t}\r\n\r\n\treturn node;\r\n};\r\n\r\nDocPreprocessor.prototype.preprocessVerticalContainer = function (node) {\r\n\tvar items = node.stack;\r\n\r\n\tfor (var i = 0, l = items.length; i < l; i++) {\r\n\t\titems[i] = this.preprocessNode(items[i]);\r\n\t}\r\n\r\n\treturn node;\r\n};\r\n\r\nDocPreprocessor.prototype.preprocessList = function (node) {\r\n\tvar items = node.ul || node.ol;\r\n\r\n\tfor (var i = 0, l = items.length; i < l; i++) {\r\n\t\titems[i] = this.preprocessNode(items[i]);\r\n\t}\r\n\r\n\treturn node;\r\n};\r\n\r\nDocPreprocessor.prototype.preprocessTable = function (node) {\r\n\tvar col, row, cols, rows;\r\n\r\n\tfor (col = 0, cols = node.table.body[0].length; col < cols; col++) {\r\n\t\tfor (row = 0, rows = node.table.body.length; row < rows; row++) {\r\n\t\t\tvar rowData = node.table.body[row];\r\n\t\t\tvar data = rowData[col];\r\n\t\t\tif (data !== undefined) {\r\n\t\t\t\tif (data === null) { // transform to object\r\n\t\t\t\t\tdata = '';\r\n\t\t\t\t}\r\n\t\t\t\tif (!data._span) {\r\n\t\t\t\t\trowData[col] = this.preprocessNode(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn node;\r\n};\r\n\r\nDocPreprocessor.prototype.preprocessText = function (node) {\r\n\tif (node.tocItem) {\r\n\t\tif (!isArray(node.tocItem)) {\r\n\t\t\tnode.tocItem = [node.tocItem];\r\n\t\t}\r\n\r\n\t\tfor (var i = 0, l = node.tocItem.length; i < l; i++) {\r\n\t\t\tif (!isString(node.tocItem[i])) {\r\n\t\t\t\tnode.tocItem[i] = '_default_';\r\n\t\t\t}\r\n\r\n\t\t\tvar tocItemId = node.tocItem[i];\r\n\r\n\t\t\tif (!this.tocs[tocItemId]) {\r\n\t\t\t\tthis.tocs[tocItemId] = { toc: { _items: [], _pseudo: true } };\r\n\t\t\t}\r\n\r\n\t\t\tif (!node.id) {\r\n\t\t\t\tnode.id = 'toc-' + tocItemId + '-' + this.tocs[tocItemId].toc._items.length;\r\n\t\t\t}\r\n\r\n\t\t\tvar tocItemRef = {\r\n\t\t\t\t_nodeRef: this._getNodeForNodeRef(node),\r\n\t\t\t\t_textNodeRef: node\r\n\t\t\t};\r\n\t\t\tthis.tocs[tocItemId].toc._items.push(tocItemRef);\r\n\t\t}\r\n\t}\r\n\r\n\tif (node.id) {\r\n\t\tif (this.nodeReferences[node.id]) {\r\n\t\t\tif (!this.nodeReferences[node.id]._pseudo) {\r\n\t\t\t\tthrow \"Node id '\" + node.id + \"' already exists\";\r\n\t\t\t}\r\n\r\n\t\t\tthis.nodeReferences[node.id]._nodeRef = this._getNodeForNodeRef(node);\r\n\t\t\tthis.nodeReferences[node.id]._textNodeRef = node;\r\n\t\t\tthis.nodeReferences[node.id]._pseudo = false;\r\n\t\t} else {\r\n\t\t\tthis.nodeReferences[node.id] = {\r\n\t\t\t\t_nodeRef: this._getNodeForNodeRef(node),\r\n\t\t\t\t_textNodeRef: node\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tif (node.pageReference) {\r\n\t\tif (!this.nodeReferences[node.pageReference]) {\r\n\t\t\tthis.nodeReferences[node.pageReference] = {\r\n\t\t\t\t_nodeRef: {},\r\n\t\t\t\t_textNodeRef: {},\r\n\t\t\t\t_pseudo: true\r\n\t\t\t};\r\n\t\t}\r\n\t\tnode.text = '00000';\r\n\t\tnode.linkToDestination = node.pageReference;\r\n\t\tnode._pageRef = this.nodeReferences[node.pageReference];\r\n\t}\r\n\r\n\tif (node.textReference) {\r\n\t\tif (!this.nodeReferences[node.textReference]) {\r\n\t\t\tthis.nodeReferences[node.textReference] = { _nodeRef: {}, _pseudo: true };\r\n\t\t}\r\n\r\n\t\tnode.text = '';\r\n\t\tnode.linkToDestination = node.textReference;\r\n\t\tnode._textRef = this.nodeReferences[node.textReference];\r\n\t}\r\n\r\n\tif (node.text && node.text.text) {\r\n\t\tnode.text = [this.preprocessNode(node.text)];\r\n\t} else if (isArray(node.text)) {\r\n\t\tvar isSetParentNode = false;\r\n\t\tif (this.parentNode === null) {\r\n\t\t\tthis.parentNode = node;\r\n\t\t\tisSetParentNode = true;\r\n\t\t}\r\n\r\n\t\tfor (var i = 0, l = node.text.length; i < l; i++) {\r\n\t\t\tnode.text[i] = this.preprocessNode(node.text[i]);\r\n\t\t}\r\n\r\n\t\tif (isSetParentNode) {\r\n\t\t\tthis.parentNode = null;\r\n\t\t}\r\n\t}\r\n\r\n\treturn node;\r\n};\r\n\r\nDocPreprocessor.prototype.preprocessToc = function (node) {\r\n\tif (!node.toc.id) {\r\n\t\tnode.toc.id = '_default_';\r\n\t}\r\n\r\n\tnode.toc.title = node.toc.title ? this.preprocessNode(node.toc.title) : null;\r\n\tnode.toc._items = [];\r\n\r\n\tif (this.tocs[node.toc.id]) {\r\n\t\tif (!this.tocs[node.toc.id].toc._pseudo) {\r\n\t\t\tthrow \"TOC '\" + node.toc.id + \"' already exists\";\r\n\t\t}\r\n\r\n\t\tnode.toc._items = this.tocs[node.toc.id].toc._items;\r\n\t}\r\n\r\n\tthis.tocs[node.toc.id] = node;\r\n\r\n\treturn node;\r\n};\r\n\r\nDocPreprocessor.prototype.preprocessImage = function (node) {\r\n\tif (!isUndefined(node.image.type) && !isUndefined(node.image.data) && (node.image.type === 'Buffer') && isArray(node.image.data)) {\r\n\t\tnode.image = Buffer.from(node.image.data);\r\n\t}\r\n\treturn node;\r\n};\r\n\r\nDocPreprocessor.prototype.preprocessSVG = function (node) {\r\n\treturn node;\r\n};\r\n\r\nDocPreprocessor.prototype.preprocessCanvas = function (node) {\r\n\treturn node;\r\n};\r\n\r\nDocPreprocessor.prototype.preprocessQr = function (node) {\r\n\treturn node;\r\n};\r\n\r\nDocPreprocessor.prototype._getNodeForNodeRef = function (node) {\r\n\tif (this.parentNode) {\r\n\t\treturn this.parentNode;\r\n\t}\r\n\r\n\treturn node;\r\n}\r\n\r\nmodule.exports = DocPreprocessor;\r\n"]},"metadata":{},"sourceType":"script"}