{"ast":null,"code":"'use strict';\n\nvar isUndefined = require('./helpers').isUndefined;\n\nvar ElementWriter = require('./elementWriter');\n/**\r\n * Creates an instance of PageElementWriter - an extended ElementWriter\r\n * which can handle:\r\n * - page-breaks (it adds new pages when there's not enough space left),\r\n * - repeatable fragments (like table-headers, which are repeated everytime\r\n *                         a page-break occurs)\r\n * - transactions (used for unbreakable-blocks when we want to make sure\r\n *                 whole block will be rendered on the same page)\r\n */\n\n\nfunction PageElementWriter(context, tracker) {\n  this.transactionLevel = 0;\n  this.repeatables = [];\n  this.tracker = tracker;\n  this.writer = new ElementWriter(context, tracker);\n}\n\nfunction fitOnPage(self, addFct) {\n  var position = addFct(self);\n\n  if (!position) {\n    self.moveToNextPage();\n    position = addFct(self);\n  }\n\n  return position;\n}\n\nPageElementWriter.prototype.addLine = function (line, dontUpdateContextPosition, index) {\n  return fitOnPage(this, function (self) {\n    return self.writer.addLine(line, dontUpdateContextPosition, index);\n  });\n};\n\nPageElementWriter.prototype.addImage = function (image, index) {\n  return fitOnPage(this, function (self) {\n    return self.writer.addImage(image, index);\n  });\n};\n\nPageElementWriter.prototype.addSVG = function (image, index) {\n  return fitOnPage(this, function (self) {\n    return self.writer.addSVG(image, index);\n  });\n};\n\nPageElementWriter.prototype.addQr = function (qr, index) {\n  return fitOnPage(this, function (self) {\n    return self.writer.addQr(qr, index);\n  });\n};\n\nPageElementWriter.prototype.addVector = function (vector, ignoreContextX, ignoreContextY, index) {\n  return this.writer.addVector(vector, ignoreContextX, ignoreContextY, index);\n};\n\nPageElementWriter.prototype.beginClip = function (width, height) {\n  return this.writer.beginClip(width, height);\n};\n\nPageElementWriter.prototype.endClip = function () {\n  return this.writer.endClip();\n};\n\nPageElementWriter.prototype.alignCanvas = function (node) {\n  this.writer.alignCanvas(node);\n};\n\nPageElementWriter.prototype.addFragment = function (fragment, useBlockXOffset, useBlockYOffset, dontUpdateContextPosition) {\n  if (!this.writer.addFragment(fragment, useBlockXOffset, useBlockYOffset, dontUpdateContextPosition)) {\n    this.moveToNextPage();\n    this.writer.addFragment(fragment, useBlockXOffset, useBlockYOffset, dontUpdateContextPosition);\n  }\n};\n\nPageElementWriter.prototype.moveToNextPage = function (pageOrientation) {\n  var nextPage = this.writer.context.moveToNextPage(pageOrientation); // moveToNextPage is called multiple times for table, because is called for each column\n  // and repeatables are inserted only in the first time. If columns are used, is needed\n  // call for table in first column and then for table in the second column (is other repeatables).\n\n  this.repeatables.forEach(function (rep) {\n    if (isUndefined(rep.insertedOnPages[this.writer.context.page])) {\n      rep.insertedOnPages[this.writer.context.page] = true;\n      this.writer.addFragment(rep, true);\n    } else {\n      this.writer.context.moveDown(rep.height);\n    }\n  }, this);\n  this.writer.tracker.emit('pageChanged', {\n    prevPage: nextPage.prevPage,\n    prevY: nextPage.prevY,\n    y: this.writer.context.y\n  });\n};\n\nPageElementWriter.prototype.beginUnbreakableBlock = function (width, height) {\n  if (this.transactionLevel++ === 0) {\n    this.originalX = this.writer.context.x;\n    this.writer.pushContext(width, height);\n  }\n};\n\nPageElementWriter.prototype.commitUnbreakableBlock = function (forcedX, forcedY) {\n  if (--this.transactionLevel === 0) {\n    var unbreakableContext = this.writer.context;\n    this.writer.popContext();\n    var nbPages = unbreakableContext.pages.length;\n\n    if (nbPages > 0) {\n      // no support for multi-page unbreakableBlocks\n      var fragment = unbreakableContext.pages[0];\n      fragment.xOffset = forcedX;\n      fragment.yOffset = forcedY; //TODO: vectors can influence height in some situations\n\n      if (nbPages > 1) {\n        // on out-of-context blocs (headers, footers, background) height should be the whole DocumentContext height\n        if (forcedX !== undefined || forcedY !== undefined) {\n          fragment.height = unbreakableContext.getCurrentPage().pageSize.height - unbreakableContext.pageMargins.top - unbreakableContext.pageMargins.bottom;\n        } else {\n          fragment.height = this.writer.context.getCurrentPage().pageSize.height - this.writer.context.pageMargins.top - this.writer.context.pageMargins.bottom;\n\n          for (var i = 0, l = this.repeatables.length; i < l; i++) {\n            fragment.height -= this.repeatables[i].height;\n          }\n        }\n      } else {\n        fragment.height = unbreakableContext.y;\n      }\n\n      if (forcedX !== undefined || forcedY !== undefined) {\n        this.writer.addFragment(fragment, true, true, true);\n      } else {\n        this.addFragment(fragment);\n      }\n    }\n  }\n};\n\nPageElementWriter.prototype.currentBlockToRepeatable = function () {\n  var unbreakableContext = this.writer.context;\n  var rep = {\n    items: []\n  };\n  unbreakableContext.pages[0].items.forEach(function (item) {\n    rep.items.push(item);\n  });\n  rep.xOffset = this.originalX; //TODO: vectors can influence height in some situations\n\n  rep.height = unbreakableContext.y;\n  rep.insertedOnPages = [];\n  return rep;\n};\n\nPageElementWriter.prototype.pushToRepeatables = function (rep) {\n  this.repeatables.push(rep);\n};\n\nPageElementWriter.prototype.popFromRepeatables = function () {\n  this.repeatables.pop();\n};\n\nPageElementWriter.prototype.context = function () {\n  return this.writer.context;\n};\n\nmodule.exports = PageElementWriter;","map":{"version":3,"sources":["/home/julianallende/Desktop/proyecto_sapo/client/node_modules/pdfmake/src/pageElementWriter.js"],"names":["isUndefined","require","ElementWriter","PageElementWriter","context","tracker","transactionLevel","repeatables","writer","fitOnPage","self","addFct","position","moveToNextPage","prototype","addLine","line","dontUpdateContextPosition","index","addImage","image","addSVG","addQr","qr","addVector","vector","ignoreContextX","ignoreContextY","beginClip","width","height","endClip","alignCanvas","node","addFragment","fragment","useBlockXOffset","useBlockYOffset","pageOrientation","nextPage","forEach","rep","insertedOnPages","page","moveDown","emit","prevPage","prevY","y","beginUnbreakableBlock","originalX","x","pushContext","commitUnbreakableBlock","forcedX","forcedY","unbreakableContext","popContext","nbPages","pages","length","xOffset","yOffset","undefined","getCurrentPage","pageSize","pageMargins","top","bottom","i","l","currentBlockToRepeatable","items","item","push","pushToRepeatables","popFromRepeatables","pop","module","exports"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nvar isUndefined = require('./helpers').isUndefined;\r\nvar ElementWriter = require('./elementWriter');\r\n\r\n/**\r\n * Creates an instance of PageElementWriter - an extended ElementWriter\r\n * which can handle:\r\n * - page-breaks (it adds new pages when there's not enough space left),\r\n * - repeatable fragments (like table-headers, which are repeated everytime\r\n *                         a page-break occurs)\r\n * - transactions (used for unbreakable-blocks when we want to make sure\r\n *                 whole block will be rendered on the same page)\r\n */\r\nfunction PageElementWriter(context, tracker) {\r\n\tthis.transactionLevel = 0;\r\n\tthis.repeatables = [];\r\n\tthis.tracker = tracker;\r\n\tthis.writer = new ElementWriter(context, tracker);\r\n}\r\n\r\nfunction fitOnPage(self, addFct) {\r\n\tvar position = addFct(self);\r\n\tif (!position) {\r\n\t\tself.moveToNextPage();\r\n\t\tposition = addFct(self);\r\n\t}\r\n\treturn position;\r\n}\r\n\r\nPageElementWriter.prototype.addLine = function (line, dontUpdateContextPosition, index) {\r\n\treturn fitOnPage(this, function (self) {\r\n\t\treturn self.writer.addLine(line, dontUpdateContextPosition, index);\r\n\t});\r\n};\r\n\r\nPageElementWriter.prototype.addImage = function (image, index) {\r\n\treturn fitOnPage(this, function (self) {\r\n\t\treturn self.writer.addImage(image, index);\r\n\t});\r\n};\r\n\r\nPageElementWriter.prototype.addSVG = function (image, index) {\r\n\treturn fitOnPage(this, function (self) {\r\n\t\treturn self.writer.addSVG(image, index);\r\n\t});\r\n};\r\n\r\nPageElementWriter.prototype.addQr = function (qr, index) {\r\n\treturn fitOnPage(this, function (self) {\r\n\t\treturn self.writer.addQr(qr, index);\r\n\t});\r\n};\r\n\r\nPageElementWriter.prototype.addVector = function (vector, ignoreContextX, ignoreContextY, index) {\r\n\treturn this.writer.addVector(vector, ignoreContextX, ignoreContextY, index);\r\n};\r\n\r\nPageElementWriter.prototype.beginClip = function (width, height) {\r\n\treturn this.writer.beginClip(width, height);\r\n};\r\n\r\nPageElementWriter.prototype.endClip = function () {\r\n\treturn this.writer.endClip();\r\n};\r\n\r\nPageElementWriter.prototype.alignCanvas = function (node) {\r\n\tthis.writer.alignCanvas(node);\r\n};\r\n\r\nPageElementWriter.prototype.addFragment = function (fragment, useBlockXOffset, useBlockYOffset, dontUpdateContextPosition) {\r\n\tif (!this.writer.addFragment(fragment, useBlockXOffset, useBlockYOffset, dontUpdateContextPosition)) {\r\n\t\tthis.moveToNextPage();\r\n\t\tthis.writer.addFragment(fragment, useBlockXOffset, useBlockYOffset, dontUpdateContextPosition);\r\n\t}\r\n};\r\n\r\nPageElementWriter.prototype.moveToNextPage = function (pageOrientation) {\r\n\r\n\tvar nextPage = this.writer.context.moveToNextPage(pageOrientation);\r\n\r\n\t// moveToNextPage is called multiple times for table, because is called for each column\r\n\t// and repeatables are inserted only in the first time. If columns are used, is needed\r\n\t// call for table in first column and then for table in the second column (is other repeatables).\r\n\tthis.repeatables.forEach(function (rep) {\r\n\t\tif (isUndefined(rep.insertedOnPages[this.writer.context.page])) {\r\n\t\t\trep.insertedOnPages[this.writer.context.page] = true;\r\n\t\t\tthis.writer.addFragment(rep, true);\r\n\t\t} else {\r\n\t\t\tthis.writer.context.moveDown(rep.height);\r\n\t\t}\r\n\t}, this);\r\n\r\n\tthis.writer.tracker.emit('pageChanged', {\r\n\t\tprevPage: nextPage.prevPage,\r\n\t\tprevY: nextPage.prevY,\r\n\t\ty: this.writer.context.y\r\n\t});\r\n};\r\n\r\nPageElementWriter.prototype.beginUnbreakableBlock = function (width, height) {\r\n\tif (this.transactionLevel++ === 0) {\r\n\t\tthis.originalX = this.writer.context.x;\r\n\t\tthis.writer.pushContext(width, height);\r\n\t}\r\n};\r\n\r\nPageElementWriter.prototype.commitUnbreakableBlock = function (forcedX, forcedY) {\r\n\tif (--this.transactionLevel === 0) {\r\n\t\tvar unbreakableContext = this.writer.context;\r\n\t\tthis.writer.popContext();\r\n\r\n\t\tvar nbPages = unbreakableContext.pages.length;\r\n\t\tif (nbPages > 0) {\r\n\t\t\t// no support for multi-page unbreakableBlocks\r\n\t\t\tvar fragment = unbreakableContext.pages[0];\r\n\t\t\tfragment.xOffset = forcedX;\r\n\t\t\tfragment.yOffset = forcedY;\r\n\r\n\t\t\t//TODO: vectors can influence height in some situations\r\n\t\t\tif (nbPages > 1) {\r\n\t\t\t\t// on out-of-context blocs (headers, footers, background) height should be the whole DocumentContext height\r\n\t\t\t\tif (forcedX !== undefined || forcedY !== undefined) {\r\n\t\t\t\t\tfragment.height = unbreakableContext.getCurrentPage().pageSize.height - unbreakableContext.pageMargins.top - unbreakableContext.pageMargins.bottom;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfragment.height = this.writer.context.getCurrentPage().pageSize.height - this.writer.context.pageMargins.top - this.writer.context.pageMargins.bottom;\r\n\t\t\t\t\tfor (var i = 0, l = this.repeatables.length; i < l; i++) {\r\n\t\t\t\t\t\tfragment.height -= this.repeatables[i].height;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfragment.height = unbreakableContext.y;\r\n\t\t\t}\r\n\r\n\t\t\tif (forcedX !== undefined || forcedY !== undefined) {\r\n\t\t\t\tthis.writer.addFragment(fragment, true, true, true);\r\n\t\t\t} else {\r\n\t\t\t\tthis.addFragment(fragment);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nPageElementWriter.prototype.currentBlockToRepeatable = function () {\r\n\tvar unbreakableContext = this.writer.context;\r\n\tvar rep = { items: [] };\r\n\r\n\tunbreakableContext.pages[0].items.forEach(function (item) {\r\n\t\trep.items.push(item);\r\n\t});\r\n\r\n\trep.xOffset = this.originalX;\r\n\r\n\t//TODO: vectors can influence height in some situations\r\n\trep.height = unbreakableContext.y;\r\n\r\n\trep.insertedOnPages = [];\r\n\r\n\treturn rep;\r\n};\r\n\r\nPageElementWriter.prototype.pushToRepeatables = function (rep) {\r\n\tthis.repeatables.push(rep);\r\n};\r\n\r\nPageElementWriter.prototype.popFromRepeatables = function () {\r\n\tthis.repeatables.pop();\r\n};\r\n\r\nPageElementWriter.prototype.context = function () {\r\n\treturn this.writer.context;\r\n};\r\n\r\nmodule.exports = PageElementWriter;\r\n"]},"metadata":{},"sourceType":"script"}